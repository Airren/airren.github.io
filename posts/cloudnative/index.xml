<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ByteGopher</title>
    <link>https://airren.github.io/posts/cloudnative/</link>
    <description>Recent content on ByteGopher</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 29 Dec 2018 11:02:05 +0800</lastBuildDate><atom:link href="https://airren.github.io/posts/cloudnative/index.xml" rel="self" type="application/rss+xml" /><item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Istio/1-Istio/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Istio/1-Istio/</guid>
      <description>Service Mesh æµ…æ
Istioçš„è‡ªæˆ‘æ•‘èµ
https://github.com/cloudnativebooks/cloud-native-istio/tree/master/chapter-files/security
äº‘åŸç”Ÿæ¶æ„çš„ä¸‰é©¾é©¬è½¦
Kubenetesï¼Œ Service Mesh , Serverless
Servcie Mesh è¶…æ—¶é‡è¯•
16å¹´æ¦‚å¿µæå‡ºã€‚
æŠ€æœ¯é€‰å‹ï¼Ÿ
ServiceMesh çš„ç›¸å…³æ¦‚å¿µ
Service Meshçš„èµ·æº
å¾®æœåŠ¡æ¶æ„çš„ç‰¹æ€§
å›´ç»•ä¸šåŠ¡æ„å»ºå›¢é˜Ÿ åº·å¨å®šå¾‹-&amp;gt; å›¢é˜Ÿç»“æ„å†³å®šäº†äº§å“ç»“æ„
å»ä¸­å¿ƒåŒ–çš„æ•°æ®ç®¡ç†
å›¢é˜Ÿå±‚é¢ï¼š å†…èšï¼Œç‹¬ç«‹ä¸šåŠ¡å¼€å‘ï¼Œæ²¡æœ‰ä¾èµ–
äº§å“å±‚é¢ï¼š æœåŠ¡å½¼æ­¤ç‹¬ç«‹ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œæ²¡æœ‰ä¾èµ–
è®¿é—®é‡å†³å®šéƒ¨ç½²å®ä¾‹çš„æ•°é‡
é“¶å¼¹ç†è®º-&amp;gt; äººæœˆç¥è¯ æ²¡æœ‰ä»»ä½•ä¸€ç§æŠ€æœ¯å¯ä»¥å®Œç¾çš„è§£å†³è½¯ä»¶å¼€å‘ä¸­çš„é—®é¢˜ã€‚
ç©ºé—´æ¢æ—¶é—´ or æ—¶é—´æ¢ç©ºé—´
å¾®æœåŠ¡æ¶æ„å¸¦æ¥çš„ç¼ºç‚¹
æœåŠ¡é—´ç½‘ç»œé€šä¿¡é—®é¢˜
åˆ†å¸ƒå¼è®¡ç®—çš„8ä¸ªè°¬è®º
ç½‘ç»œæ˜¯å¯é çš„ ç½‘ç»œå»¶æ—¶æ˜¯0 å¾ˆéš¾ä¼šæŠŠç½‘ç»œç›¸å…³çš„éœ€æ±‚è€ƒè™‘åˆ°æˆ‘ä»¬çš„è®¾è®¡ä¸­ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œé—®é¢˜æ˜¯ä¸€ä¸ªé‡è¦é—®é¢˜ã€‚
å¦‚ä½•ç®¡ç†å’Œæ§åˆ¶ç½‘ç»œé€šä¿¡
è¾…åŠ©æ³¨å†Œã€å‘ç°
è·¯ç”±ï¼Œæµé‡è½¬ç§»
å¼¹æ€§èƒ½åŠ› ç†”æ–­è¶…æ—¶é‡è¯•
å®‰å…¨
å¯è§‚æµ‹æ€§
Pattenï¼š Service Mesh
é˜¶æ®µä¸€ï¼š æ§åˆ¶é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆ
é˜¶æ®µäºŒï¼š å…¬å…±åº“ï¼šæµæ§ï¼Œé‡è¯• ï¼ˆäººåŠ›ï¼Œæ—¶é—´å­¦ä¹ ï¼Œè¯­è¨€èšŒç»‘å®šï¼Œå¹³å°ç›¸å…³ï¼Œä»£ç ä¾µå…¥ï¼‰
é˜¶æ®µä¸‰ï¼šä»£ç†æ¨¡å¼ï¼Œ åŠŸèƒ½ç®€é™‹Nginx
é˜¶æ®µå››ï¼š Sidecar æ¨¡å¼ 2013-2105
é˜¶æ®µäº”ï¼š Service Mesh 2016-2017
â€‹ Service MeshV2 2018</description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/k8s-Istio-Envoy/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/k8s-Istio-Envoy/</guid>
      <description>What is Service Mesh(æœåŠ¡ç½‘æ ¼) https://jimmysong.io/blog/why-do-you-need-istio-when-you-already-have-kubernetes/
UPF
2 æ¬¡é“¾æ¥
1 æ§åˆ¶é¢ ip register step 1-4
hub å…¬æœ‰ç½‘ç»œç›´è¿æ¥ï¼Œ ç»™edge podåˆ†é…å…¨å±€IPï¼Œcluster api server CRD controller ç›‘è§†CRs &amp;ndash;&amp;gt; kube cofig
2 æ•°æ®é¢
hub-device connection
hub æ¡¥æ¥
IPSec configuration -&amp;gt; 2 æ¬¡åˆ†å‘
SNAT-&amp;gt; DNAT IP åœ°å€å¯èƒ½é‡åˆ
æµ‹è¯•ç¯å¢ƒéƒ¨ç½² 4 cluster
ç‰©ç†æœº 4 nuc
10.239.241.255 &amp;ndash; hub
switch äº¤æ¢æœº
kubectl get iphost
kubectl describe iphost hubdevice1
kubectl get
spce:
pubkry
conn_type
proposal åŠ è§£å¯†
mark route base VPN</description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/curl/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/curl/</guid>
      <description></description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/iptables/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/iptables/</guid>
      <description>TCP çš„æœ‰é™çŠ¶æ€æœº
CLOSED CLOSED
SYN_SENT LISTENING
â€‹ SYN_RECEIVED
ESTABLISHED ESTABLISHED
netfilter: Frame
iptables: æ•°æ®æŠ¥æ–‡è¿‡æ»¤
é˜²ç«å¢™ï¼š ç¡¬ä»¶/è½¯ä»¶
è§„åˆ™ï¼š åŒ¹é…æ ‡å‡†å’Œå¤„ç†åŠæ³•
é»˜è®¤è§„åˆ™ï¼š
â€‹ å…³é—­
åŒ¹é…æ ‡å‡†ï¼š
IP:æºIPï¼Œ ç›®æ ‡IP
TCP: SPORT, DPORT SYN=1,FIN=0,RST=0,ACK=0
UDP:SPORT, DPORT
ICMP: icmp-type
è§„åˆ™åœ¨å†…æ ¸ç©ºé—´
å†…æ ¸ç©ºé—´çš„TCPIPçš„åè®®æ ˆä¸Šï¼Œå¼€æ”¾ç»™ç”¨æˆ·ç©ºé—´ä¸­çš„iptables APIã€‚
å†…æ ¸ç©ºé—´çš„å·¥ä½œæ¡†æ¶ï¼š
ç”¨æˆ·ç©ºé—´çš„ç®¡ç†å·¥å…·ï¼š system call
å‚è€ƒ openBSD
Linux 2.0ï¼šipfw/firewall
Linux 2.2ï¼š ipchain/firewall Linux 2.4 ï¼š iptables/netfilter
1ï¼š07
1/proc/sys/net/ipv4/ip_forward è·¯ç”±å†³ç­–å‘ç”Ÿåœ¨æ•°æ®åŒ…åˆ°è¾¾ç½‘å¡ï¼Œ é€åˆ°TCPIPåè®®æ ˆä¸Šçš„é‚£ä¸€åˆ»ã€‚ ç„¶åå…ˆå‘ç”Ÿè·¯ç”±å†³ç­–
netfilter è¡¥å……åœ¨tcp ipåè®®ä¸Šçš„3ä¸ªhook functionã€‚
å¤šä¸ªè§„åˆ™ï¼Œè‡ªä¸Šè€Œä¸‹ï¼Œé€ä¸ªæ£€æŸ¥ï¼Œ
ä¸åšæ‹’ç»æˆ–è€…æ”¾è¡Œç­–ç•¥
4ï¼š åˆšåˆšè¿›å…¥æœ¬æœºç½‘å¡ï¼Œè¿˜æ²¡æœ‰åˆ°è¾¾è·¯ç”±è¡¨ã€‚ï¼ˆåœ°å€è½¬æ¢k&amp;rsquo;kï¼‰
5ï¼š å³å°†ç¦»å¼€æœ¬æœºçš„æ—¶å€™ï¼Œè·¯ç”±å†³ç­–åšå‡ºä¹‹åã€‚
è§„åˆ™é“¾
PREROUTING
INPUT
FORWARD
OUTPUT</description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/jq/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/jq/</guid>
      <description></description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/port/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/port/</guid>
      <description>æŸ¥çœ‹ç«¯å£çš„å ç”¨æƒ…å†µ
1netstat -atunlp 2 3# ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿå½“å‰ç½‘ç»œçŠ¶æ€ä¿¡æ¯ï¼Œ åŒ…æ‹¬ç«¯å£ã€è¿æ¥æƒ…å†µç­‰ 4# -t: TCPç«¯å£ 5# -u: UDPç«¯å£ 6# -l: ä»…æ˜¾ç¤ºç›‘å¬Socket LISTENçŠ¶æ€çš„Socket 7# -p: æ˜¾ç¤ºè¿›ç¨‹æ ‡è¯†ç¬¦å’Œç¨‹åºåç§°ï¼Œæ¯ä¸€ä¸ªsocketéƒ½å±äºä¸€ä¸ªç¨‹åº 8# -n: ä¸è¿›è¡ŒDNSè§£æ 9# -a: æ˜¾ç¤ºæ‰€æœ‰è¿æ¥çš„ç«¯å£ 10 11 12 13 14lsof 15# åˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶(list open files) 16# -i:[num] æŒ‡å®šç«¯å£ 1nslookup # åŸŸåè§£æ 2host 3dig </description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/route/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/route/</guid>
      <description></description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/wan3/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/wan3/</guid>
      <description>mwan3
å•çº¿å¤šæ‹¨</description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/%E8%BF%9B%E7%A8%8B%E6%97%A5%E5%BF%97/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/%E8%BF%9B%E7%A8%8B%E6%97%A5%E5%BF%97/</guid>
      <description></description>
    </item>
    
    <item>
      <title></title>
      <link>https://airren.github.io/posts/cloudnative/Linux/%E8%BF%9B%E7%A8%8B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/%E8%BF%9B%E7%A8%8B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</guid>
      <description></description>
    </item>
    
    <item>
      <title>ã€ŒDockerã€ Docker å¸¸ç”¨å‘½ä»¤</title>
      <link>https://airren.github.io/posts/cloudnative/Docker/dock_tips/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Docker/dock_tips/</guid>
      <description>centos å®‰è£…docker æŠŠyumåŒ…æ›´æ–°åˆ°æœ€æ–°
1yum update å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…
1yum install -y yum-utils device-mapper-persistent-data lvm2 è®¾ç½®yumæº
1yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo æŸ¥çœ‹æ‰€æœ‰ä»“åº“ä¸­æ‰€æœ‰dockerç‰ˆæœ¬ï¼Œå¹¶é€‰æ‹©ç‰¹å®šç‰ˆæœ¬å®‰è£…
1yum list docker-ce --showduplicates | sort -r 2 3[root@MiWiFi-R3-srv ~]# yum list docker-ce --showduplicates | sort -r 4 * updates: mirrors.aliyun.com 5Loading mirror speeds from cached hostfile 6Loaded plugins: fastestmirror 7Installed Packages 8 * extras: mirrors.aliyun.com 9docker-ce.x86_64 3:18.09.0-3.el7 docker-ce-stable 10docker-ce.x86_64 18.06.1.ce-3.el7 docker-ce-stable 11docker-ce.x86_64 18.06.1.ce-3.el7 @docker-ce-stable 12docker-ce.x86_64 18.06.0.ce-3.el7 docker-ce-stable 13docker-ce.x86_64 18.03.1.ce-1.el7.centos docker-ce-stable 14docker-ce.x86_64 18.03.0.ce-1.el7.centos docker-ce-stable 15.</description>
    </item>
    
    <item>
      <title>ã€ŒDockerã€Docker ç½‘ç»œæ¨¡å¼</title>
      <link>https://airren.github.io/posts/cloudnative/Docker/docker_net/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Docker/docker_net/</guid>
      <description>docker runåˆ›å»ºå®¹å™¨æ—¶å€™ï¼Œå¯ä»¥ç”¨-netæŒ‡å®šå®¹å™¨çš„ç½‘ç»œæ¨¡å¼
1# host æ¨¡å¼ 2--net=host 3# containeræ¨¡å¼ 4--net=container:NameorId 5# noneæ¨¡å¼ 6-net=none 7# bridgeæ¨¡å¼ 8-net=bridge host æ¨¡å¼
å¦‚æœå¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ host æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ Network Namespaceï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network Namespaceã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚
ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ 10.10.101.105/24 çš„æœºå™¨ä¸Šç”¨ host æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå«æœ‰ web åº”ç”¨çš„ Docker å®¹å™¨ï¼Œç›‘å¬ tcp 80 ç«¯å£ã€‚å½“æˆ‘ä»¬åœ¨å®¹å™¨ä¸­æ‰§è¡Œä»»ä½•ç±»ä¼¼ ifconfig å‘½ä»¤æŸ¥çœ‹ç½‘ç»œç¯å¢ƒæ—¶ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯å®¿ä¸»æœºä¸Šçš„ä¿¡æ¯ã€‚è€Œå¤–ç•Œè®¿é—®å®¹å™¨ä¸­çš„åº”ç”¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ 10.10.101.105:80 å³å¯ï¼Œä¸ç”¨ä»»ä½• NAT è½¬æ¢ï¼Œå°±å¦‚ç›´æ¥è·‘åœ¨å®¿ä¸»æœºä¸­ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯å’Œå®¿ä¸»æœºéš”ç¦»çš„ã€‚
container æ¨¡å¼ è¿™ä¸ªæ¨¡å¼æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª Network Namespaceï¼Œè€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº« IPã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ä¸¤ä¸ªå®¹å™¨çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ lo ç½‘å¡è®¾å¤‡é€šä¿¡ã€‚
noneæ¨¡å¼ è¿™ä¸ªæ¨¡å¼å’Œå‰ä¸¤ä¸ªä¸åŒã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒDocker å®¹å™¨æ‹¥æœ‰è‡ªå·±çš„ Network Namespaceï¼Œä½†æ˜¯ï¼Œå¹¶ä¸ä¸º Dockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª Docker å®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸º Docker å®¹å™¨æ·»åŠ ç½‘å¡ã€é…ç½® IP ç­‰ã€‚
bridgeæ¨¡å¼ bridge æ¨¡å¼æ˜¯ Docker é»˜è®¤çš„ç½‘ç»œè®¾ç½®ï¼Œæ­¤æ¨¡å¼ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é… Network Namespaceã€è®¾ç½® IP ç­‰ï¼Œå¹¶å°†ä¸€ä¸ªä¸»æœºä¸Šçš„ Docker å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚å½“ Docker server å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º docker0 çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„ Docker å®¹å™¨ä¼šè¿æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚è™šæ‹Ÿç½‘æ¡¥çš„å·¥ä½œæ–¹å¼å’Œç‰©ç†äº¤æ¢æœºç±»ä¼¼ï¼Œè¿™æ ·ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨å°±é€šè¿‡äº¤æ¢æœºè¿åœ¨äº†ä¸€ä¸ªäºŒå±‚ç½‘ç»œä¸­ã€‚æ¥ä¸‹æ¥å°±è¦ä¸ºå®¹å™¨åˆ†é… IP äº†ï¼ŒDocker ä¼šä» RFC1918 æ‰€å®šä¹‰çš„ç§æœ‰ IP ç½‘æ®µä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªå’Œå®¿ä¸»æœºä¸åŒçš„IPåœ°å€å’Œå­ç½‘åˆ†é…ç»™ docker0ï¼Œè¿æ¥åˆ° docker0 çš„å®¹å™¨å°±ä»è¿™ä¸ªå­ç½‘ä¸­é€‰æ‹©ä¸€ä¸ªæœªå ç”¨çš„ IP ä½¿ç”¨ã€‚å¦‚ä¸€èˆ¬ Docker ä¼šä½¿ç”¨ 172.</description>
    </item>
    
    <item>
      <title>ã€ŒK8sã€Kubernates å®‰è£…</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/KubernatesInstall/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/KubernatesInstall/</guid>
      <description>ç¯å¢ƒå‡†å¤‡ K8s åªèƒ½åŸºäºLinuxç¯å¢ƒéƒ¨ç½²ï¼Œç”¨Win/Macçš„å°ä¼™ä¼´ä»¬æ€ä¹ˆåœ¨è‡ªå·±çš„PCä¸ŠSetupç¯å¢ƒå‘¢ã€‚æ­¤æ—¶å°±æ¨èCanonicalå®¶çš„Multipassäº†ï¼ŒCanonical æ˜¯è°ï¼Œå½“ç„¶æ˜¯Ubuntuçš„æ¯å…¬å¸äº†ã€‚
å®‰è£… kubelet kubeadm kubectl å®˜æ–¹æ–‡æ¡£
1sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y apt-transport-https curl 2curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add - 3cat &amp;lt;&amp;lt;EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list 4deb https://apt.kubernetes.io/ kubernetes-xenial main 5EOF 6sudo apt-get update 7sudo apt-get install -y kubelet kubeadm kubectl 8sudo apt-mark hold kubelet kubeadm kubectl # è®¾ç½®ä¸ºä¸å†æ›´æ–° åˆå§‹åŒ– 1swapoff -a 2kubeadm init ctl 3# kubeadm config images pull --v=10 4 # å›½å†…æ­£å¸¸ç½‘ç»œä¸èƒ½ä»k8s.</description>
    </item>
    
    <item>
      <title>Docker Images</title>
      <link>https://airren.github.io/posts/cloudnative/Docker/docker_build_image/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Docker/docker_build_image/</guid>
      <description>é•œåƒä»“åº“ Linux æœ¬åœ°é•œåƒä»“åº“ï¼š/var/lib/docker/image
é•œåƒåº”è¯¥æ˜¯åˆ†å±‚å­˜å‚¨çš„ã€‚
Docker images æ˜¯å­˜å‚¨åœ¨é•œåƒä»“åº“æœåŠ¡Images Registryã€‚Docker å®¢æˆ·ç«¯çš„é•œåƒä»“åº“æœåŠ¡æ˜¯å¯é…ç½®çš„ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯Docker Hubã€‚
é•œåƒä»“åº“æœåŠ¡åŒ…å«å¤šä¸ªé•œåƒä»“åº“ Image Repositoryï¼ˆåŒä¸€ä¸ªé•œåƒçš„ä¸åŒç‰ˆæœ¬ï¼‰ã€‚ä¸€ä¸ªé•œåƒä»“åº“ä¸­åŒ…å«å¤šä¸ªé•œåƒImageã€‚
Docker Hub ä¹Ÿåˆ†ä¸ºOfficial Repository å’Œ Unofficial Repositoryã€‚
1docker pull &amp;lt;repository&amp;gt;:&amp;lt;tag&amp;gt; 2// å¦‚æœçœç•¥tagé»˜è®¤ä¼špull tag ä¸º latestçš„imageã€‚ä½†æ˜¯latestå¹¶ä¸ä¿è¯è¿™æ˜¯ä»“åº“ä¸­æœ€æ–°çš„é•œåƒã€‚ å¦‚æœå¸Œæœ›ä»ç¬¬ä¸‰æ–¹é•œåƒæœåŠ¡ä»“åº“è·å–é•œåƒ(not Docker Hub)ï¼Œåˆ™éœ€è¦åœ¨é•œåƒä»“åº“åç§°å‰åŠ ä¸Šç¬¬ä¸‰æ–¹é•œåƒä»“åº“æœåŠ¡çš„DNSåç§°ã€‚
1# gcr.io -&amp;gt; Google Container Images Registry. 2docker pull gcr.io/k8s-staging-nfd/node-feature-discovery:master Image Tag ä¸åŒçš„Images Tagå¯ä»¥ç»‘å®šåŒä¸€ä¸ªImage ID
é€šè¿‡--filter æ¥è¿‡æ»¤docker image ls è¿”å›çš„å†…å®¹
1docker image ls --filter dangling=true dangling image -&amp;gt; with out name &amp;amp; tag :.
é€šå¸¸å› ä¸ºæ„å»ºæ–°çš„é•œåƒï¼Œä¸ºè¯¥é•œåƒæ‰“äº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ ‡ç­¾ã€‚Dockerä¼šremove old imageä¸Šçš„æ ‡ç­¾ï¼Œå°†è¯¥æ ‡ç­¾æ ‡åœ¨æ–°Imageä¸Šã€‚Old Image å°±ä¼šå˜æˆ dangling imageã€‚</description>
    </item>
    
    <item>
      <title>Docker networking</title>
      <link>https://airren.github.io/posts/cloudnative/Docker/docker_networking/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Docker/docker_networking/</guid>
      <description>Docker networking is based on an open-source pluggable architecture called the Container Network Model(CNM). libnetwork is Docker&amp;rsquo;s real-work implementation of the CNM, adn it provides all of the Docker&amp;rsquo;s core networking capabilities. Drivers plug into libnework to provide specifice network topologies.
The theory At the highest level, Docker networking comprise three major components.
Single-host bridge network </description>
    </item>
    
    <item>
      <title>freeå‘½ä»¤</title>
      <link>https://airren.github.io/posts/cloudnative/Linux/free/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/free/</guid>
      <description>type desc total physical mem used used = total- free-buffers-cache free Free/Unused memory shared It is here only for backward comopatibility buff/cache The combined memory used by the kernel buffers and page cache ans slabs. This memory can be reclaimed at any time if needed by the applicaitons. If you want buffers and cache to displayed in two separate columns, use -w options. available An estimate of the amount of memory that is availablew for starting new applications, without swaping.</description>
    </item>
    
    <item>
      <title>Git</title>
      <link>https://airren.github.io/posts/cloudnative/Linux/git/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/git/</guid>
      <description>1# git cache user and passwd 2git config --global credential.helper cache </description>
    </item>
    
    <item>
      <title>K8s Cloud Native</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/1-k8s-cloudnative/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/1-k8s-cloudnative/</guid>
      <description>Kubenetesç”Ÿäº§è½åœ°å…¨ç¨‹å®è·µ
æ ¸å¿ƒæ¦‚å¿µ
æ¶æ„è®¾è®¡
è®¤è¯æˆæƒ
é«˜å¯ç”¨é›†ç¾¤æ­å»º
äºŒè¿›åˆ¶&amp;amp; kubeadm
3å°masterä¸¤å°2 node
calicoã€corednsã€dashboard
ä¸šåŠ¡è¿ç§»åˆ°Kubenetes
Harbor
æœåŠ¡å‘ç°ç­–ç•¥
IngressNginx
Docker åŒ–æœåŠ¡ã€K8sã€æœåŠ¡å‘ç°
CICD
namespaceã€resourcesã€label
æœåŠ¡çš„è°ƒåº¦ä¸ç¼–æ’
å¥åº·æ£€æŸ¥
è°ƒåº¦ç­–ç•¥
éƒ¨ç½²ç­–ç•¥
æ—¥å¿—ä¸ç›‘æ§
ç¬¬2ç«  kuberneteså¿«é€Ÿå…¥é—¨ æœ¬ç« ä¸­å°†ä»æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€è®¤è¯æˆæƒä»¥åŠé›†ç¾¤æ­å»ºæ–¹æ¡ˆå¯¹æ¯”å‡ æ–¹é¢ï¼Œå¸¦é¢†å¤§å®¶å¿«é€ŸæŒæ¡kubernetesçš„é‡è¦çŸ¥è¯†ç‚¹ï¼ŒåŠ©åŠ›å¿«é€Ÿå…¥é—¨ã€‚
2-1 äº†è§£kubernetes èˆµæ‰‹ï¼š æ¸”ç½‘ã€æ¸”èˆ¹ docker : é²¸é±¼ï¼Œé›†è£…ç®± ğŸ³
Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications.
It groups containers that makeup application in to logical units for easy management and discovery.Kubernetes builds upon 15 years of experience of running production workloads at Google, combined with best-of-breed ideas and practices from the community.</description>
    </item>
    
    <item>
      <title>K8s ConfigMap</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/9-k8s-configmap/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/9-k8s-configmap/</guid>
      <description>ç»™Podä¼ é€’å‚æ•° é€šè¿‡ç¯å¢ƒå˜é‡ç»™Podä¼ é€’å‚æ•° å¯ä»¥åœ¨containerçš„æè¿°æ–‡ä»¶ä¸­åŠ å…¥ä¸€ä¸ªenvçš„å‚æ•°ï¼Œå€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯é”®å€¼å¯¹ï¼Œå€¼æ˜¯stringã€‚
1--- 2apiVersion: v1 3kind: Pod 4metadata: 5 name: first-pod 6 labels: 7 app: nginx 8spec: 9 containers: 10 - name: 00-simple-pod-nginx 11 image: nginx:1.17.0 12 env: 13 - name: INTERVAL 14 value: 30s é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ç»™Podä¼ é€’å‚æ•° åŠ å…¥ä¸€ä¸ªargsé…ç½®ï¼Œå‘½ä»¤è¡Œå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</description>
    </item>
    
    <item>
      <title>K8s DaemonSet</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/7-k8s-daemonset/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/7-k8s-daemonset/</guid>
      <description>NodeExporter ç”¨äºé‡‡é›†ä¸€ä¸ªHostä¸Šçš„å„ç§æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶ä¸”æš´éœ²ç»™Prometheus é‡‡é›†ã€‚å› ä¸ºNodeExporteréœ€è¦é‡‡é›†æ¯ä¸€ä¸ªHostçš„æ•°æ®çŠ¶æ€ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨æ¯ä¸€ä¸ªK8sçš„æœºå™¨ä¸Šéƒ½è¦è¿è¡Œä¸€ä¸ªPod, è€Œå®ç°è¿™ä¸ªéœ€æ±‚çš„K8sèµ„æºç±»å‹å°±å«åšDaemonSetã€‚
DaemonSet DaemonSetçš„åŠŸèƒ½å°±æ˜¯ä¿è¯æ¯ä¸ªNodeéƒ½è¿è¡ŒPodï¼Œ ä½†æ˜¯å¦‚æœæŸä¸ªK8sçš„Nodeä¸‹çº¿ä¹‹åï¼Œå¯¹åº”çš„Podä¹Ÿä¸‹çº¿ï¼Œè¿˜æ˜¯ä¿æŒæ¯ä¸ªNodeä¸€ä¸ªPodã€‚å¦‚æœæ–°å¢ä¸€ä¸ªNodeï¼Œå°±ä¼šåœ¨æ–°å¢çš„Nodeä¸­å¢åŠ ä¸€ä¸ªPodï¼Œä¿è¯æ‰€æœ‰çš„Nodeä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªå½“å‰Podã€‚
1--- 2apiVersion: apps/v1 3kind: DaemonSet 4metadata: 5 name: node-exporter 6 namespace: kube-system 7 labels: 8 k8s-app: node-exporter 9 kubernetes.io/cluster-service: &amp;#34;true&amp;#34; 10 addonmanager.kubernetes.io/mode: Reconcile 11 version: v1.2.2 12spec: 13 selector: 14 matchLabels: 15 k8s-app: node-exporter 16 version: v1.2.2 17 updateStrategy: 18 type: OnDelete 19 template: 20 metadata: 21 labels: 22 k8s-app: node-exporter 23 version: v1.2.2 24 spec: 25 priorityClassName: system-node-critical 26 containers: 27 - name: prometheus-node-exporter 28 image: &amp;#34;prom/node-exporter:v1.</description>
    </item>
    
    <item>
      <title>K8s Deployments</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/5-k8s-deployment/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/5-k8s-deployment/</guid>
      <description>è“ç»¿éƒ¨ç½² è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„éƒ¨ç½²æ–¹å¼ï¼Œç»å¸¸ä¼šç”¨äºæ–°æ—§ç‰ˆæœ¬ä¸å…¼å®¹çš„æƒ…å†µã€‚
å…ˆå°†æ–°ç‰ˆæœ¬(ç»¿ç‰ˆ)çš„æœåŠ¡è¿è¡Œèµ·æ¥ã€‚ å°†æ‰€æœ‰çš„æµé‡åˆ‡åˆ°æ–°ç‰ˆæœ¬çš„æœåŠ¡ä¸Š åˆ é™¤æ—§ç‰ˆæœ¬(è“ç‰ˆ)çš„æœåŠ¡ åˆ›å»ºæ–°ç‰ˆæœ¬çš„ReplicaSetï¼Œå°†ServiceæŒ‡å‘æ–°çš„Podsï¼Œåˆ é™¤æ—§ç‰ˆæœ¬çš„ReplicaSet
æ»šåŠ¨å‡çº§ è“ç»¿éƒ¨ç½²å¯ä»¥æœ‰æ•ˆä¿è¯ä¸šåŠ¡çš„æ­£ç¡®æ€§ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„é£é™©ï¼Œä¾‹å¦‚ç¨³å®šæ€§ã€‚
å‡è®¾æ–°éƒ¨ç½²çš„åº”ç”¨æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸€æ—¦åˆ‡æ¢ä¹‹åå°±ä¼šå¯¼è‡´ä¸šåŠ¡çš„å´©æºƒï¼Œé€ æˆæŸå¤±ã€‚äºæ˜¯å°±æœ‰äº†ç¨å¾®å‹å¥½çš„å‡çº§æ–¹å¼ï¼Œæ»šåŠ¨å‡çº§ã€‚
å…ˆå…³é—­ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„å®ä¾‹ å¼€å¯ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„å®ä¾‹ç”¨äºæ›¿æ¢æ—§ç‰ˆæœ¬ æ›¿æ¢æˆåŠŸæ—¶å€™å¾ªç¯1å’Œ2ï¼Œç›´åˆ°æ‰€æœ‰çš„å®ä¾‹å‡çº§å®Œæˆã€‚ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸­é€”å‘ç°å¼‚å¸¸å¯ä»¥åŠæ—¶åœæ‰‹ï¼ŒåŠæ—¶æ­¢æŸã€‚è€Œä¸”Kubernetesä¹Ÿåœ¨å®¢æˆ·ç«¯ä¸­æ”¯æŒäº†è¿™ä¸ªç‰¹æ€§ã€‚kubectl rolling-updateã€‚
å‡çº§å‰åRCçš„Selectoréƒ½è¢«æ”¹å˜äº† æ“ä½œéƒ½æ˜¯åœ¨å®¢æˆ·ç«¯æ‰§è¡Œçš„ï¼Ÿ é‡‘ä¸é›€å‘å¸ƒ é‡‘ä¸é›€å‘å¸ƒæ˜¯æ»šåŠ¨å‘å¸ƒçš„ä¸€ç§ç‰¹ä¾‹ï¼Œåœ¨æ»šåŠ¨å‘å¸ƒä¸­ï¼Œæ˜¯ä¸ä¼šç­‰å¾…çš„ï¼Œé™¤éä¸­é—´å‡ºé”™äº†ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³è¦å…¨éƒ½å‡çº§ï¼Œå¯èƒ½åªæ˜¯å¤„äºPOCçš„ä¸€äº›åŸå› ï¼Œæˆ‘ä»¬åªå¸Œæœ›éƒ¨åˆ†å®ä¾‹æ˜¯æ–°çš„ï¼Œå¤§éƒ¨åˆ†æ˜¯æ—§çš„ï¼Œè€Œè¿™ç§æƒ…å½¢ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºé‡‘ä¸é›€å‘å¸ƒã€‚
å‡çº§å°‘éƒ¨åˆ†å®ä¾‹ æŸ¥çœ‹æ•ˆæœï¼Œå¦‚æœå¥½ï¼Œå…¨éƒ¨å‡çº§ å¦‚æœä¸å¥½ï¼Œåˆ™ä¸å‡çº§ å£°æ˜å¼å‡çº§ å‰é¢ä»‹ç»çš„è¿™äº›å‡çº§å‘å¸ƒæ–¹å¼åœ¨K8sä¸Šå¾ˆå¤šæ—¶å€™æ˜¯åŠæ‰‹å·¥æ–¹å¼æ‰§è¡Œçš„ï¼Œè€ŒKubernetesä½œä¸ºä¸€æ¬¾DevOPSå‹å¥½çš„ç³»ç»Ÿï¼Œå·²ç»å†…ç½®äº†å¯¹äºéƒ¨ç½²æ–¹å¼çš„ä¸€ç§èµ„æºæŠ½è±¡ï¼Œè¿™ä¸ªèµ„æºå°±æ˜¯ï¼šDeploymentã€‚
Deployment &amp;ndash;&amp;gt; ReplicaSet &amp;ndash;&amp;gt; Pods
Deployment å­˜åœ¨çš„æ„ä¹‰ä¸ºï¼šåœ¨å‡çº§åº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦å¼•å…¥é¢å¤–çš„ReplicaSetï¼Œå¹¶åè°ƒæ–°æ—§ä¸¤ä¸ªRSï¼Œä½¿ä»–ä»¬å†æ ¹æ®å½¼æ­¤ä¸æ–­ä¿®æ”¹ï¼Œè€Œä¸ä¼šé€ æˆå¹²æ‰°ã€‚Deploymentå°†è¿™äº›è¿ç»´è¿‡ç¨‹éƒ½ä»£ç åŒ–ï¼Œå†…ç½®ä¸ºè‡ªå·±çš„é€»è¾‘ï¼Œä»è€Œè®©å‡çº§å˜å¾—ç®€å•ã€‚
é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨Deploymentåˆ›å»º3ä¸ªå®ä¾‹
1# deploy.yaml 2--- 3apiVersion: apps/v1 4kind: Deployment 5metadata: 6 name: first-deployment 7 labels: 8 app: simple-pod-deployment 9spec: 10 replicas: 3 11 selector: 12 matchLabels: 13 app: simple-pod-deployment 14 template: 15 metadata: 16 name: simple-pod-deployment 17 labels: 18 app: simple-pod-deployment 19 spec: 20 containers: 21 - name: simple-pod-de 22 image: lukelau/rest-docker:0.</description>
    </item>
    
    <item>
      <title>K8s Job</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/6-k8s-job/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/6-k8s-job/</guid>
      <description>Replicas å’Œdeploymentè¿™ä¸¤ç±»èµ„æºéƒ½æ˜¯ç”¨äºæ§åˆ¶workloadçš„ã€‚è¿™ä¸¤ç§ç±»å‹çš„èµ„æºä¸€èˆ¬éƒ½æ˜¯æŒç»­è¿è¡Œçš„ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€äº›è¾…åŠ©æ–¹å¼å¸®åŠ©workloadå‡ºç°å¼‚å¸¸æ—¶æ¢å¤ï¼Œä»¥åŠæ ¹æ®æƒ…å†µè¿›è¡ŒåŠ¨æ€ä¼¸ç¼©çš„ç‰¹æ€§ã€‚
Job æ ¹æ®Jobçš„å®šä¹‰åˆ›å»ºå‡ºå¯¹åº”çš„Podï¼Œç„¶åå…³æ³¨Podçš„çŠ¶æ€ï¼Œ ç›´åˆ°æ»¡è¶³å®šä¹‰ã€‚ä¾‹å¦‚Podæ‰§è¡ŒæˆåŠŸäº†æˆ–è€…æ‰§è¡Œå¤±è´¥äº†ï¼Œå¹¶ä¸”è¾¾åˆ°äº†é‡è¯•æ¬¡æ•°ã€‚
1--- 2apiVersion: batch/v1 3kind: Job 4metadata: 5 name: pi 6spec: 7 template: 8 spec: 9 containers: 10 - name: pi 11 image: perl 12 command: [&amp;#34;perl&amp;#34;, &amp;#34;-Mbignum=bpi&amp;#34;,&amp;#34;-wle&amp;#34;, &amp;#34;print bpi(2000)&amp;#34;] 13 restartPolicy: Never 14 backoffLimit: 4 Jobæ­£å¸¸æ‰§è¡Œç»“æŸåç»“æœå¦‚ä¸Šå›¾ã€‚è¿™æ˜¯ä¸€ä¸ªåªæ‰§è¡Œä¸€æ¬¡çš„Jobã€‚å®ƒçš„æ“ä½œæ–¹å¼å°±æ˜¯åˆ›å»ºä¸€ä¸ªPodï¼Œç„¶åè¿è¡Œä¸€éï¼Œç„¶åå°±é€€å‡ºã€‚å¦‚æœæƒ³æ‰§è¡Œå¤šæ¬¡ï¼Œåˆ™åªéœ€è¦å¢åŠ ä¸€ä¸ªå‚æ•°
1completions: 2 æ‰§è¡Œ2æ¬¡æ—¶åˆ›å»ºäº†ä¸¤ä¸ªPodï¼Œç„¶åä¿è¯è¿™ä¸¤ä¸ªPodéƒ½æ‰§è¡ŒæˆåŠŸã€‚
æˆ‘ä»¬åœ¨ä½¿ç”¨Deploymentç­‰Workloadçš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šrestartPolicyï¼Œé»˜è®¤éƒ½æ˜¯RestartOnFailã€‚åœ¨Jobä¸­ä¸èƒ½è¿™ä¹ˆæŒ‡å®šï¼Œå› ä¸ºè¿™ä¸ªé€»è¾‘åº”è¯¥ç”±Jobæ¥æ§åˆ¶ï¼Œ è€Œä¸æ˜¯è®©Podæ¥æ§åˆ¶ã€‚
CronJob å®šæ—¶ä»»åŠ¡ï¼Œ CronJobå°±æ˜¯åœ¨Jobçš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†å‘¨æœŸå®šä¹‰çš„API
1--- 2apiVersion: batch/v1 3kind: CronJob 4metadata: 5 name: batch-job-pi 6spec: 7 schedule: &amp;#34;0,15,30,45 * * * *&amp;#34; 8 jobTemplate: 9 spec: 10 template: 11 metadata: 12 labels: 13 app: pi-job 14 spec: 15 containers: 16 - name: pi 17 image: perl 18 command: [&amp;#34;perl&amp;#34;, &amp;#34;-Mbignum=bpi&amp;#34;,&amp;#34;-wle&amp;#34;, &amp;#34;print bpi(2000)&amp;#34;] 19 restartPolicy: Never </description>
    </item>
    
    <item>
      <title>K8s Overview</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/1-k8s-overview/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/1-k8s-overview/</guid>
      <description>Node èŠ‚ç‚¹ä¸»è¦è´Ÿè´£å®¹å™¨çš„ç®¡ç†ï¼Œç”¨äºè¿è¡Œå®¹å™¨å’Œä¿è¯å®¹å™¨çš„çŠ¶æ€ã€‚é»˜è®¤æƒ…å†µä¸‹MasterèŠ‚ç‚¹ä¸æ‰¿æ‹…NodeèŠ‚ç‚¹çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç‰¹æ®Šçš„é…ç½®è®©MasterèŠ‚ç‚¹ä¹Ÿå¯ä½œä¸ºNodeèŠ‚ç‚¹ã€‚
Etcdç”¨äºå­˜å‚¨Kubernetesçš„å…ƒæ•°æ®ï¼Œä½†æ˜¯ä¸è¦æ±‚ä¸€å®šè¦ä»¥å®¹å™¨çš„å½¢å¼è¿è¡Œã€‚
1kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.0.22 --pod-network-cidr pod çš„ippool, --apiserver-advertise-address ä¸ºæš´éœ²çš„k8sAPIè°ƒç”¨IP.
èŠ‚ç‚¹(Node)
ä¸€ä¸ªNodeæ˜¯ä¸€ä¸ªè¿è¡ŒK8sçš„ä¸»æœºï¼Œä½œä¸ºK8s worker, é€šå¸¸ç§°ä¹‹ä¸ºMinionã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œå¦‚ä¸‹K8så…³é”®ç»„ä»¶ï¼š
kubeletï¼šä¸»èŠ‚ç‚¹ä»£ç† kube-proxy: serviceä½¿ç”¨å…¶å°†é“¾æ¥è·¯ç”±åˆ°Pod docker/rocket: k8s ä½¿ç”¨å®¹å™¨æŠ€æœ¯åˆ›å»ºå®¹å™¨ å®¹å™¨ç»„(Pod)
ä¸€ä¸ªPodå¯¹åº”è‹¥å¹²å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®¹å™¨ç»„ï¼ŒåŒä¸€ä¸ªPodå†…çš„å®¹å™¨å…±äº«ä¸€ä¸ªå­˜å‚¨å·(volume)ï¼ŒåŒä¸€ä¸ªPodä¸­çš„å®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œNamespace,å¯ä»¥ä½¿ç”¨localhostäº’ç›¸é€šä¿¡ã€‚
Podæ˜¯çŸ­æš‚çš„ï¼Œä¸æ˜¯æŒç»­æ€§å®ä½“ã€‚ä¸€ä¸ªPodæ˜¯ä¸€ä¸ªç‰¹å®šçš„åº”ç”¨æ‰“åŒ…é›†åˆï¼ŒåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚å’Œè¿è¡Œçš„å®¹å™¨ç±»ä¼¼ï¼Œä¸€ä¸ªPodåªæœ‰å¾ˆçŸ­çš„è¿è¡Œå‘¨æœŸã€‚Podè¢«è°ƒåº¦åˆ°ä¸€ä¸ªNodeè¿è¡Œï¼Œç›´åˆ°å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç»“æŸæˆ–è€…å…¶è¢«åˆ é™¤ã€‚
å®¹å™¨ç»„ç”Ÿå‘½å‘¨æœŸ(Pod Status)
åŒ…å«æ‰€æœ‰å®¹å™¨çŠ¶æ€é›†åˆï¼ŒåŒ…æ‹¬å®¹å™¨ç»„çŠ¶æ€ç±»å‹ï¼Œå®¹å™¨ç»„ç”Ÿå‘½å‘¨æœŸï¼Œäº‹ä»¶ï¼Œé‡å¯ç­–ç•¥ï¼Œä»¥åŠreplication controllers.
æ ‡ç­¾(labels)
æ ‡ç­¾æ˜¯ç”¨æ¥è¿æ¥ä¸€ç»„å¯¹è±¡çš„ï¼Œæ¯”å¦‚å®¹å™¨ç»„Podã€‚lableå¯ä»¥ç”¨æ¥ç»„ç»‡å’Œé€‰æ‹©å­å¯¹è±¡ã€‚ ä¸€ä¸ªLabelæ˜¯attachåˆ°Podçš„ä¸€å¯¹é”®å€¼å¯¹ï¼Œç”¨æ¥ä¼ é€’ç”¨æˆ·å®šä¹‰çš„å±æ€§ã€‚
Replication Controllers
ä¸»è¦è´Ÿè´£æŒ‡å®šæ•°é‡çš„Podåœ¨åŒä¸€æ—¶é—´ä¸€èµ·è¿è¡Œã€‚Replication controller ç¡®ä¿ä»»æ„æ—¶é—´éƒ½æœ‰æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬åœ¨è¿è¡Œã€‚å¦‚æœä¸ºæŸä¸ªPodåˆ›å»ºäº†Replication Controllerå¹¶ä¸”æŒ‡å®šä¸º3å‰¯æœ¬ï¼Œå®ƒä¼šåˆ›å»º3ä¸ªPod,å¹¶æŒç»­ç›‘æ§ä»–ä»¬ã€‚å¦‚æœæŸä¸ªPodä¸å“åº”ï¼Œé‚£ä¹ˆReplication controller ä¼šæ›¿æ¢å®ƒï¼Œä¿æŒPodæ€»æ•°ä¸º3.
å½“åˆ›å»ºReplication Controlleræ—¶ï¼Œéœ€è¦æŒ‡å®šä¸¤ä¸ªä¸œè¥¿ã€‚
Podæ¨¡æ¿ï¼š ç”¨æ¥åˆ›å»ºPodå‰¯æœ¬çš„æ¨¡æ¿ Labelï¼šReplication Controller éœ€è¦ç›‘æ§çš„Podçš„Label ç°åœ¨å·²ç»åˆ›å»ºäº†Podçš„ä¸€äº›å‰¯æœ¬ï¼Œé‚£ä¹ˆåœ¨è¿™äº›å‰¯æœ¬ä¸Šå¦‚ä½•è´Ÿè½½å‡è¡¡å‘¢ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯service
Serviceï¼š
å¦‚æœPodæ˜¯çŸ­æš‚çš„ï¼Œé‚£ä¹ˆé‡å¯æ—¶IPåœ°å€å¯èƒ½ä¼šå˜ï¼Œæ€ä¹ˆæ‰èƒ½ä»å‰ç«¯å®¹å™¨æ­£ç¡®å¯é çš„æŒ‡å‘åå°å®¹å™¨å‘¢ã€‚
Serviceæ˜¯å®šä¹‰ä¸€ç³»åˆ—Podä»¥åŠè®¿é—®è¿™äº›Podçš„ç­–ç•¥çš„ä¸€å±‚æŠ½è±¡ã€‚Serviceé€šè¿‡Labelæ‰¾åˆ°Podç»„ã€‚å› ä¸ºserviceæ˜¯æŠ½è±¡çš„ï¼Œæ‰€åœ¨åœ¨å›¾è¡¨é‡Œé€šå¸¸çœ‹ä¸åˆ°ä»–ä»¬çš„å­˜åœ¨ã€‚
ç°åœ¨å‡å®šæœ‰ä¸¤ä¸ªåå°Pod,å¹¶ä¸”å®šä¹‰åå°serviceåç§°ä¸ºâ€œbackend-serviceâ€ï¼Œlabelé€‰æ‹©å™¨ä¸º(tier=backend,app=myapp)ã€‚backend-serviceçš„Serviceä¼šå®Œæˆå¦‚ä¸‹ä¸¤ä»¶é‡è¦çš„äº‹æƒ…ï¼š
ä¼šä¸ºServiceåˆ›å»ºä¸€ä¸ªæœ¬åœ°é›†ç¾¤çš„DNSå…¥å£ï¼Œå› æ­¤å‰ç«¯åªéœ€è¦DNSæŸ¥æ‰¾ä¸»æœºåä¸ºâ€œbackend-serviceâ€å°±èƒ½å¤Ÿè§£æå‡ºå‰ç«¯åº”ç”¨ç¨‹åºå¯ç”¨çš„IPåœ°å€ ç°åœ¨å‰ç«¯å·²ç»å¾—åˆ°äº†åå°æœåŠ¡çš„IPåœ°å€ï¼Œä½†æ˜¯å®ƒåº”è¯¥è®¿é—®2ä¸ªåå°Podä¸­çš„å“ªä¸€ä¸ªå‘¢ã€‚Serviceåœ¨è¿™ä¸¤ä¸ªåå°Podä¹‹é—´æä¾›é€æ˜çš„è´Ÿè½½å‡è¡¡ï¼Œä¼šå°†è¯·æ±‚å‘ç»™å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚é€šè¿‡æ¯ä¸ªNodeä¸Šè¿è¡Œçš„ä»£ç† kube-proxyå®Œæˆã€‚ Kubernetes Master
é›†ç¾¤æ‹¥æœ‰ä¸€ä¸ªK8s Master,K8s Master æä¾›é›†ç¾¤çš„ç‹¬ç‰¹è§†è§’ï¼Œå¹¶æ‹¥æœ‰ä¸€ç³»åˆ—ç»„ä»¶ï¼Œå¦‚Kubernetes API server. API server æä¾›å¯ä»¥ç”¨æ¥å’Œé›†ç¾¤äº¤äº’çš„REST ç«¯ç‚¹ã€‚Master èŠ‚ç‚¹åŒ…å«ç”¨æ¥åˆ›å»ºå’Œå¤åˆ¶Podçš„Replication Controller.
å‚è€ƒèµ„æ–™ï¼š</description>
    </item>
    
    <item>
      <title>K8s StafulSet</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/8-k8s-stafulset/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/8-k8s-stafulset/</guid>
      <description>å‰é¢ä»‹ç»çš„å‡ ç§workloadéƒ½æœ‰ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯åˆ›å»ºå‡ºæ¥çš„Podéƒ½æ˜¯ä¸€è‡´çš„ã€‚æ‰€è°“çš„ä¸€è‡´å°±æ˜¯è¯´ï¼Œå‡è®¾æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ReplicaSetï¼Œåˆ›å»ºäº†3ä¸ªPodï¼Œé‚£ä¹ˆè¿™3ä¸ªPodåˆ›äº†åå­—ä¸€å®šä¸ä¸€æ ·ä¹‹å¤–ï¼Œå…¶ä»–å±æ€§å¯èƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒ…æ‹¬è¿è¡Œæ—¶çš„å‚æ•°å’Œæ¨¡å¼ä»¥åŠæ•°æ®å­˜å‚¨ã€‚
å¦‚æœæ˜¯Web Serviceï¼Œæ•°æ®ä¿å­˜åˆ°åç«¯çš„DBä¸­ï¼Œä¸Šè¿°é€»è¾‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚
å¦‚æœä½¿ç”¨ReplicaSetæ¥éƒ¨ç½²ä¸€ä¸ªDBçš„å¤šå®ä¾‹ï¼Œ å°±å¯è‚¯èƒ½å­˜åœ¨é—®é¢˜äº†ã€‚
æ•°æ®æŒä¹…åŒ–ï¼Œä¸€èˆ¬ä½¿ç”¨PVCï¼Œå½“ä½¿ç”¨PVC å’ŒPVçš„æ—¶å€™
â€‹
ReplicaSet -&amp;gt; Pods(3 ä¸ª) -&amp;gt; æŒä¹…å·å£°æ˜ -&amp;gt; æŒä¹…å·
3ä¸ªPodçš„æ•°æ®éƒ½å†™åˆ°åŒä¸€ä¸ªPvä¸­ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Ÿï¼Ÿï¼Ÿ
StatefulSet ä¸ºäº†è§£å†³Podçš„çŠ¶æ€æ€§çš„é—®é¢˜ï¼ŒK8så¼•å…¥äº†StatefulSetçš„æ¦‚å¿µ
Podæœ‰å•ç‹¬çš„å­˜å‚¨å’Œå›ºå®šçš„ç½‘ç»œæ ‡è¯† éœ€è¦é…å¤‡ä¸€ä¸ªheadless Serviceï¼Œç”¨äºDNS å¯ä»¥é€šè¿‡DNSå¿«é€Ÿå‘ç°å…¶ä»–çš„Pod å¯ä»¥ç›´æ¥é€šè¿‡Pod DNSé€šä¿¡ æ¯ä¸ªPodéƒ½å¯ä»¥é€šè¿‡DNSè®¿é—®åˆ°ï¼Œè¿™ç§ç‰¹æ€§åœ¨å…¶ä»–workloadä¸­æ˜¯ä¸èƒ½å®ç°çš„ã€‚é€šè¿‡StatefulSetå¯ä»¥è®©PodæŒæœ‰çŠ¶æ€ï¼Œå³ä½¿å› ä¸ºæ•…éšœPodé‡å»ºäº†ï¼Œé‚£ä¹ˆå¯¹åº”çš„Podçš„åå­—å’Œæ•°æ®éƒ½ä¼šä¿ç•™ï¼Œå’Œé‡å»ºä¹‹å‰æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
ä½¿ç”¨StatefulSet å¿…é¡»å»ºç«‹ä¸€ä¸ªHeadlessServiceï¼Œç„¶åç»‘å®šè¿™ä¸ªheadlessserviceåˆ°StatefulSetã€‚
ä»¥MongoDBä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªStatefulSetï¼Œå› ä¸ºè¿˜æ²¡æœ‰ä»‹ç»åˆ°PVCå’ŒPVçš„å†…å®¹ï¼Œæ‰€ä»¥MongoDBå°†ä½¿ç”¨æœ¬åœ°å­˜å‚¨å·ã€‚
åˆ›å»ºHeadless Service
åˆ›å»º StatefulSet
é€šè¿‡DNSè®¿é—®Pod
åœ¨StatefulSetçš„Podä¸­å¯ä»¥é€šè¿‡DNSç›´æ¥è®¿é—®å…¶ä»–Podã€‚
1mongo --host mongo-1.mongo å¯ä»¥é€šè¿‡&amp;lt;pod-name&amp;gt;.&amp;lt;service-name&amp;gt;çš„å½¢å¼è®¿é—®Podã€‚è¿™å…¶å®å’ŒStatefulSetçš„è®¾è®¡æ˜¯æœ‰å…³ç³»çš„ï¼Œåœ¨ç±»ä¼¼çš„Deploymentä¸­Podçš„åå­—æ˜¯ä¸å›ºå®šçš„ï¼Œè€Œåœ¨StatefulSetä¸­ï¼ŒPodçš„åå­—æ˜¯å›ºå®šçš„ã€‚
å’ŒReplicaSetå¯¹æ¯”
å› ä¸ºæœ‰çŠ¶æ€çš„Podå½¼æ­¤ä¸åŒï¼Œé€šå¸¸å¸Œæœ›æ“ä½œçš„æ˜¯å…¶ä¸­çš„ç‰¹å®šçš„ä¸€ä¸ªï¼Œæ‰€ä»¥StatefulSeté€šå¸¸è¦æ±‚ä½ åˆ›å»ºä¸€ä¸ªç”¨æ¥è®°å½•æ¯ä¸ªPodç½‘ç»œæ ‡è®°çš„HeadlessServiceã€‚é€šè¿‡è¿™ä¸ªServiceï¼Œæ¯ä¸ªPodéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„DNSè®°å½•ï¼Œè€Œè¿™åœ¨ReplicaSetä¸­æ˜¯ä¸è¡Œçš„ï¼Ÿï¼ˆå¦‚æœä¸ºReplicaSetåˆ›å»ºä¸€ä¸ªHeadless Serviceä¼šå‘ç”Ÿå•¥ï¼Ÿï¼‰ å› ä¸ºStatefulSetç¼©å®¹ä»»ä½•æ—¶å€™åªä¼šæ“ä½œä¸€ä¸ªPodå®ä¾‹ï¼Œæ‰€ä»¥æœ‰çŠ¶æ€åº”ç”¨çš„ç¼©å®¹ä¸ä¼šå¾ˆè¿…é€Ÿã€‚ StatefulSetåœ¨æœ‰å®ä¾‹ä¸å¥åº·çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸å…è®¸ç¼©å®¹çš„ã€‚ æŒä¹…å­˜å‚¨ ä¸€ä¸ªStatefulSetå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå·å£°æ˜æ¨¡æ¿ï¼Œè¿™äº›å£°æ˜ä¼šåœ¨åˆ›å»ºPodå‰åˆ›å»ºå‡ºæ¥ï¼Œç»‘å®šåˆ°ä¸€ä¸ªPodçš„å®ä¾‹ä¸Šã€‚ æ‰©å®¹StatefulSetä¼šåˆ›å»ºä¸¤ä¸ªAPIå¯¹è±¡ï¼Œä¸€ä¸ªPodå’Œä¸€ä¸ªå·å£°æ˜ï¼›ä½†æ˜¯ç¼©å®¹StatefulSetå´ä¼šåˆ é™¤ä¸€ä¸ªPodå¯¹è±¡ï¼Œè€Œä¼šç•™ä¸‹PVCï¼Œå› ä¸ºä¸€æ—¦åˆ é™¤PVCåˆ™æ„å‘³ç€PVä¼šè¢«å›æ”¶ã€‚ StatefulSet at-most-one
Kubernetes å¿…é¡»ä¿è¯ä¸¤ä¸ªæ‹¥æœ‰ç›¸åŒæ ‡è®°å’Œç»‘å®šç›¸åŒæŒä¹…å·å£°æ˜çš„æœ‰çŠ¶æ€çš„Podå®ä¾‹ä¸ä¼šåŒæ—¶è¿è¡Œã€‚ä¸€ä¸ªStatefulSetå¿…é¡»ä¿è¯æœ‰çŠ¶æ€çš„å®ä¾‹çš„ at-most-one è¯­ä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´StatefulSetå¿…é¡»ä¿è¯ä¸€ä¸ªPodä¸å†è¿è¡Œåï¼Œæ‰ä¼šå»åˆ›å»ºå®ƒçš„æ›¿æ¢Podã€‚</description>
    </item>
    
    <item>
      <title>Kubenetes Pod</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/2-k8s-pod/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/2-k8s-pod/</guid>
      <description>Pod
åœ¨Kubernetesä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯èµ„æºï¼Œä½ å¯ä»¥é€šè¿‡create/get/describe/delete æ¥æ“ä½œè¿™äº›èµ„æºã€‚
åœ¨æ“ä½œä¸€ç§èµ„æºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹è¿™ä¸ªèµ„æºè¿›è¡Œå®šä¹‰ï¼Œåœ¨k8sä¸­å¸¸ç”¨çš„æ˜¯yamlé…ç½®æ–‡ä»¶é…ç½®ã€‚
1# 00-siample-pod.yaml 2--- 3apiVersion: v1 4kind: Pod 5metadata: 6 name: first-pod 7 labels: 8 app: nginx 9spec: 10 containers: 11 - name: 00-simple-pod-nginx 12 images: nginx:1.17.0 apiVersionï¼šèµ„æºçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç†è§£ä¸ºä½ è¦åˆ›å»ºçš„æ˜¯ PodV1{}è¿˜æ˜¯PodVn{}
kind: èµ„æºçš„ç±»å‹
metadataï¼š
â€‹	nameï¼š åˆ›å»ºå‡ºæ¥çš„èµ„æºçš„åå­—
â€‹ labelsï¼šä¸å…¶ä»–èµ„æºç²’åº¦æˆ–è€…æ“ä½œçš„å…³è”
spec: èµ„æºçš„å‚æ•°
é€šè¿‡kubectl apply -fåˆ›å»ºèµ„æº
1kubectl apply -f 00-simple-pod.yaml å¦‚æœéœ€è¦æ›´æ–°èµ„æºï¼Œä¿®æ”¹yamlåï¼Œé‡æ–°kubectl apply -f xxx.yaml å°±å¯ä»¥ã€‚
è·å–PodçŠ¶æ€
1kubectl get pod first-pod 2# get more detail 3kubectl get pod first-pod -o wide 4# get all pods of all-namespace 5kubectl get po -A è·å–Pod è¯¦æƒ…</description>
    </item>
    
    <item>
      <title>Kubernetes CRD</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/10-k8s-crd/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/10-k8s-crd/</guid>
      <description>Kubernetes 1.16 æ­£å¼GAäº†CRDã€‚
CRDä»‹ç» å£°æ˜å¼ç¼–ç¨‹ åœ¨Kubernetesä¸­æˆ‘ä»¬ä½¿ç”¨äº†Deployment/DamenSet/tatefulSetæ¥ç®¡ç†åº”ç”¨workdloadï¼Œä½¿ç”¨Service/Ingressæ¥ç®¡ç†åº”ç”¨çš„
https://zhuanlan.zhihu.com/p/34445114</description>
    </item>
    
    <item>
      <title>Kubernetes Replication Controller</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/4-k8s-replic/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/4-k8s-replic/</guid>
      <description>Replication Controller 1# replica.yaml 2--- 3apiVersion: v1 4kind: ReplicationController 5metadata: 6 name: first-replic 7spec: 8 replicas: 3 9 template: 10 metadata: 11 name: simple-pod 12 labels: 13 app: simple-pod 14 spec: 15 containers: 16 - name: timemachine 17 image: lukelau/rest-docker:0.0.1 18 args: 19 - -server.addr=0.0.0.0:8000 ä»¥ä¸Šé…ç½®ä¼šä¿è¯Podçš„æ•°é‡ç¨³å®šä¸º3ä¸ªã€‚å½“æˆ‘ä»¬åˆ é™¤ä¸€ä¸ªPodä¹‹åï¼ŒReplication Controllerå°±ä¼šåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„Podæ¥ç»´æŒPodçš„æ•°é‡ã€‚
RCä¹‹æ‰€ä»¥ä¼šå‘ç°Podå·²ç»æŒ‚æ‰äº†ï¼Œæ˜¯å› ä¸ºæ¢é’ˆ(Container probes)çš„å­˜åœ¨ã€‚åœ¨K8sä¸­ï¼Œ kubeletä¼šé€šè¿‡æŒ‡å®šçš„æ¢é’ˆæ–¹å¼å»æ¢æµ‹å®¹å™¨æ˜¯å¦å­˜æ´»ã€‚
ä¸‰ç§æ¢é’ˆæ–¹å¼
ä¸‰ç§ç±»å‹çš„handler
ExecActionï¼š Executes a specified sommand inside the container. The diagnostic is considered successful if the command exits with a status code of 0.</description>
    </item>
    
    <item>
      <title>Kubernetes Service</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/3-k8s-service/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/3-k8s-service/</guid>
      <description>Podæ˜¯æœ€å°çš„å•å…ƒï¼Œ å¾€å¾€æˆ‘ä»¬åœ¨è¿è¡Œä¸€ä¸ªåº”ç”¨çš„æ—¶å€™ï¼Œå¯¹Podæœ‰ä¸€äº›é¢å¤–çš„è¦æ±‚ï¼Œä¾‹å¦‚é«˜å¯ç”¨æˆ–è€…å¤šå®ä¾‹ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœä½ åªè®°ä½ä¸€ä¸ªPodçš„IPï¼Œé‚£ä¹ˆå¾ˆå¤šæ—¶å€™æ—¶æœ‰é—®é¢˜çš„ã€‚ ä¾‹å¦‚é«˜å¯ç”¨ï¼Œå¯èƒ½ä¼šå› ä¸ºPodçš„é‡å»ºè€Œæ”¹å˜ï¼Œè¿™æ ·ä½ è®°ä½çš„é‚£ä¸ªIPå°±å¤±æ•ˆäº†ã€‚ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯å›ºå®šIPã€‚
ä¸ºä»€ä¹ˆè¦ä½¿ç”¨service
å› ä¸ºK8sé‡Œé¢çš„Podæ˜¯å¯ä»¥è¢«è°ƒåº¦çš„ï¼Œå¹¶ä¸”é‡å»ºçš„ï¼Œæ‰€ä»¥æ²¡æœ‰å›ºå®šçš„IP Podçš„æ•°é‡å¯èƒ½ä¸åªä¸€ä¸ªï¼Œå½“æœ‰å¤šä¸ªPodå®ä¾‹çš„æ—¶å€™è´Ÿè½½å‡è¡¡çš„éœ€æ±‚ã€‚ 1# service.yaml 2--- 3apiVersion: v1 4kind: Service 5metadata: 6 name: first-service 7spec: 8 type: NodePort 9 selector: 10 app: nginx 11 ports: 12 - protocol: TCP 13 port: 5580 14 targetPort: 80 15 nodePort: 32280 selector è¿‡æ»¤æºå¸¦label app=nginxçš„pod
targetPortï¼š pod æä¾›æœåŠ¡çš„ç«¯å£
serviceä»£ç†Podçš„å†…éƒ¨ç«¯å£ä¸º5580ï¼š å†…éƒ¨è®¿é—®ï¼Œå›ºå®šIPï¼šPort
serviceä»£ç†Podçš„å¤–éƒ¨ç«¯å£ä¸º32280ï¼Œ é€šè¿‡k8sé›†ç¾¤çš„IPï¼Œå¯ä»¥è¿›è¡Œ å¤–éƒ¨å¯è®¿é—®
1# create service 2kubectl apply -f service.yaml 3# get service status 4kubectl get service first-service å¤–éƒ¨è®¿é—®service
ä¸Šé¢è¿™ä¸ªé…ç½®ä¹‹æ‰€ä»¥å¯ä»¥åœ¨å¤–éƒ¨è®¿é—®ï¼Œæ˜¯å› ä¸ºåˆ¶å®šäº†Serviceçš„Typeä¸ºNodePortï¼Œ åœ¨K8sä¸­å¦‚æœä¸æŒ‡å®šè¿™ä¸ªTypeçš„è¯ï¼Œserviceæ—¶åªèƒ½åœ¨K8sé›†ç¾¤å†…éƒ¨è®¿é—®çš„ï¼Œé›†ç¾¤å¤–éƒ¨æ˜¯è®¿é—®ä¸äº†çš„ã€‚</description>
    </item>
    
    <item>
      <title>å‚æ•°ä¼ é€’</title>
      <link>https://airren.github.io/posts/cloudnative/Linux/%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92/</guid>
      <description>1. é¡ºåºä¼ å‚ å‚æ•°å ä½œç”¨ $0 filename $1/$2/$3 &amp;hellip;.$n ç¬¬nä¸ªå‚æ•° 2. OPT åªèƒ½ç”¨å•ä¸ªå­—æ¯
1#!/bin/bash 2 3while getopts &amp;#34;:n:a:h&amp;#34; optname; do 4	case &amp;#34;$optname&amp;#34; in 5	&amp;#34;n&amp;#34;) 6	echo &amp;#34;get option -name, value is $OPTARG&amp;#34; 7	;; 8	&amp;#34;a&amp;#34;) 9	echo &amp;#34;get option -age, value is $OPTARG&amp;#34; 10	;; 11	&amp;#34;h&amp;#34;) 12	echo &amp;#39; 13	-n name of user 14	-a age of user 15	&amp;#39; 16	;; 17	&amp;#34;:&amp;#34;) 18	echo &amp;#34;No argument value for option $OPTARG&amp;#34; 19	;; 20K	&amp;#34;?</description>
    </item>
    
    <item>
      <title>å®¹å™¨æŠ€æœ¯åŸºç¡€</title>
      <link>https://airren.github.io/posts/cloudnative/Kubernates/Container-Intro/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Kubernates/Container-Intro/</guid>
      <description>ä¸ºä»€ä¹ˆå®¹å™¨é‡Œåªèƒ½è·‘â€œä¸€ä¸ªè¿›ç¨‹â€ï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘åŸå…ˆä¸€ç›´åœ¨ç”¨æŸä¸ªJVMå‚æ•°ï¼Œåœ¨å®¹å™¨é‡Œå°±ä¸å¥½ä½¿äº†ï¼Ÿ ä¸ºä»€ä¹ˆkuberneteså°±ä¸èƒ½å›ºå®šIPåœ°å€ï¼Ÿå®¹å™¨ç½‘ç»œè”ä¸é€šåˆè¯¥å¦‚ä½•å»debugï¼Ÿ Kubernetesä¸­çš„StatefulSetå’ŒOperatoråˆ°åº•ä»€ä¹ˆåŒºåˆ«ï¼ŸPCå’ŒPVCè¿™äº›æ¦‚å¿µåˆè¯¥æ€ä¹ˆç”¨ï¼Ÿ Linuxè¿›ç¨‹æ¨¡å‹å¯¹å®¹å™¨æœ¬èº«çš„é‡è¦æ„ä¹‰ï¼Œæ§åˆ¶å™¨æ¨¡å¼å¯¹æ•´ä¸ªK8sé¡¹ç›®æçº²æŒˆé¢†çš„ä½œç”¨ï¼Ÿ ä»PaaSåˆ°K8s PaaS PaaS(Platform as a Service) åº”ç”¨æ‰˜ç®¡ã€‚
Dockeré•œåƒï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œç›´æ¥ç”±ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•æ„æˆã€‚
å…¶å®åªæ‰“åŒ…äº†æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„å†…æ ¸ã€‚å„ç§å†…æ ¸ç›¸å…³çš„æ¨¡å—æˆ–è€…ç‰¹æ€§æ”¯æŒå®Œå…¨ä¾èµ–äºå®¿ä¸»æœºã€‚
é€šè¿‡docker build æ‰“åŒ…é•œåƒï¼Œdocker run è¿è¡Œé•œåƒï¼Œdocker runåˆ›å»ºçš„æ²™ç›’ï¼Œå°±æ˜¯ä½¿ç”¨Linux Cgroupså’ŒNamespaceæœºåˆ¶åˆ›å»ºå‡ºæ¥çš„éš”ç¦»ç¯å¢ƒã€‚è§£å†³äº†åº”ç”¨æ‰“åŒ…è¿™ä¸ªæ ¹æœ¬æ€§é—®é¢˜ã€‚
Swarm swarm æä¾›é›†ç¾¤ç®¡ç†åŠŸèƒ½
å•æœºdockeré¡¹ç›®
1docker run &amp;lt;container-name&amp;gt; å¤šæœºdockeré¡¹ç›®
1docker run -H &amp;#39;swarm cluster API&amp;#39; &amp;lt;container-name&amp;gt;	Fig é¡¹ç›® Figé¡¹ç›®ç¬¬ä¸€æ¬¡åœ¨å¼€å‘è€…é¢å‰æå‡ºäº†å®¹å™¨ç¼–æ’(Container Orchestration)çš„æ¦‚å¿µã€‚
åŠ å…¥ç”¨æˆ·ç°åœ¨éœ€è¦éƒ¨ç½²çš„æ˜¯åº”ç”¨å®¹å™¨Aã€æ•°æ®åº“å®¹å™¨Bã€è´Ÿè½½å‡è¡¡å®¹å™¨Cï¼Œé‚£ä¹ˆFigå°±å…è®¸ç”¨æˆ·æŠŠABCä¸‰ä¸ªå®¹å™¨å®šä¹‰åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œ å¹¶ä¸”å¯ä»¥æŒ‡å®šä»–ä»¬ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œæ¯”å¦‚å®¹å™¨Aéœ€è¦è®¿é—®æ•°æ®åº“Bã€‚å®šä¹‰å¥½ä¹‹åï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¡éå¸¸ç®€å•çš„æŒ‡ä»¤ã€‚
1fig up Figå°±ä¼šæŠŠè¿™äº›å®¹å™¨çš„å®šä¹‰å’Œé…ç½®äº¤ç»™DockerAPIæŒ‰ç…§è®¿é—®é€»è¾‘ä¸€æ¬¡åˆ›å»ºã€‚è€Œå®¹å™¨Aå’ŒBä¹‹é—´çš„å…³è”å…³ç³»ï¼Œä¹Ÿä¼šäº¤ç»™dockerçš„LinkåŠŸèƒ½é€šè¿‡å†™å…¥hostsæ–‡ä»¶çš„æ–¹å¼è¿›è¡Œé…ç½®ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä½ è¿˜å¯ä»¥åœ¨Figçš„é…ç½®æ–‡ä»¶é‡Œå®šä¹‰å„ç§å®¹å™¨çš„å‰¯æœ¬ä¸ªæ•°ç­‰ç¼–æ’å‚æ•°ã€‚
Fig é¡¹ç›®è¢«Dockeræ”¶è´­åæ›´åä¸ºComposeã€‚
Libcontainer LibContainer -&amp;gt; RunC
ä»¥RunCä¸ºä¾æ®ï¼Œåˆ¶å®šå®¹å™¨å’Œé•œåƒçš„æ ‡å‡†å’Œè§„èŒƒã€‚
OCI(Open Container Initiative), æ„åœ¨å°†å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒçš„å®ç°ä»Dockeré¡¹ç›®ä¸­å®Œå…¨å‰¥ç¦»å‡ºæ¥ã€‚
Containerd å®¹å™¨è¿è¡Œæ—¶
è¿›ç¨‹éš”ç¦»ä¸é™åˆ¶ ç¨‹åºè¢«æ‰§è¡Œèµ·æ¥ï¼Œå®ƒå°±ä»ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå˜æˆäº†è®¡ç®—æœº å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¯„å­˜å™¨é‡Œçš„å€¼ï¼Œå †æ ˆä¸­çš„æŒ‡ä»¤ã€è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œä»¥åŠå„ç§è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯çš„ä¸€ä¸ªé›†åˆã€‚åƒè¿™æ ·ä¸€ä¸ªç¨‹åºè¿è¡Œèµ·æ¥åçš„è®¡ç®—æœºæ‰§è¡Œç¯å¢ƒçš„æ€»å’Œï¼Œå°±æ˜¯ï¼šè¿›ç¨‹ã€‚
å¯¹äºè¿›ç¨‹æ¥è¯´ï¼Œå®ƒçš„é™æ€è¡¨ç°å°±æ˜¯ç¨‹åºï¼Œä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼›è€Œä¸€æ—¦è¿è¡Œèµ·æ¥ï¼Œå°±å˜æˆäº†è®¡ç®—æœºæ•°æ®å’ŒçŠ¶æ€çš„æ€»å’Œï¼Œè¿™å°±æ˜¯è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ã€‚
å®¹å™¨æŠ€æœ¯çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°ï¼Œä»è€Œä¸ºå…¶åˆ›é€ å‡ºä¸€ä¸ªâ€œè¾¹ç•Œâ€ã€‚å¯¹äºå¤§å¤šæ•°Linuxå®¹å™¨æ¥è¯´ï¼Œ Cgroupsæ˜¯ç”¨æ¥åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µï¼Œ è€ŒNamespaceæŠ€æœ¯åˆ™æ˜¯ç”¨æ¥ä¿®æ”¹è¿›ç¨‹è§†å›¾çš„ä¸»è¦æ–¹æ³•ã€‚
éš”ç¦» 1docker run -it busybox /bin/sh What is BusyBox?</description>
    </item>
    
    <item>
      <title>ç­–ç•¥è·¯ç”±</title>
      <link>https://airren.github.io/posts/cloudnative/Linux/%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://airren.github.io/posts/cloudnative/Linux/%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1/</guid>
      <description>ç­–ç•¥è·¯ç”± æ‰€æœ‰æ¥è‡ªç½‘ç»œAçš„åŒ…é€‰æ‹©Xè·¯å¾„ï¼Œå…¶ä»–é€‰æ‹©Yè·¯å¾„ã€‚æˆ–è€…è¯´æ‰€æœ‰TOSä¸ºAçš„åŒ…é€‰æ‹©è·¯å¾„F,å…¶ä»–é€‰æ‹©è·¯å¾„K.
å¤šè¡¨è·¯ç”±ï¼ˆmultiple Routing Tablesï¼‰ ä¼ ç»Ÿçš„è·¯ç”±ç®—æ³•ä»…ä»…ä½¿ç”¨ä¸€å¼ è¡¨ï¼Œæœ‰äº›æƒ…å½¢ä¸‹æ˜¯éœ€è¦ä½¿ç”¨å¤šè·¯ç”±è¡¨çš„ã€‚
è§„åˆ™ï¼ˆRuleï¼‰ æ‰€æœ‰æ¥è‡ª192.168.1.5çš„åŒ…ï¼Œä½¿ç”¨è·¯ç”±è¡¨10,æœ¬è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯990
æ‰€åˆ°åˆ°192.168.127.117çš„åŒ…ä½¿ç”¨è·¯ç”±è¡¨11, æœ¬è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯991ï¼›
è§„åˆ™ä¸‰è¦ç´ 
ä»€ä¹ˆæ ·çš„åŒ…åº”ç”¨æœ¬è§„åˆ™ ip route add å¢åŠ è·¯ç”±åˆ°æŒ‡å®šçš„è·¯ç”±è¡¨ï¼Œé»˜è®¤ä¸ºmainè¡¨</description>
    </item>
    
    
  </channel>
</rss>
