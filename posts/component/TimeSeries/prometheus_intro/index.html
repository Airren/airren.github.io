<!DOCTYPE html>
<html>
  <head>
    <title>「Prom」Prometheus 安装及使用简介</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>

<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link rel="stylesheet" href="/google-fonts/Mulish/mulish.css"/>


<link rel="stylesheet" href="/fontawesome/css/all.min.css"/>







  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/favicon_hufa9bb061875e5783d83b75135c052e0b_6105_42x0_resize_box_3.png" />

<meta property="og:title" content="「Prom」Prometheus 安装及使用简介" />
<meta property="og:description" content="Prometheus Intro Prometheus 是SoundCloud开源的系统监控和报警工具集。通过Prometheus可以进行时序数据的采集、监控和报警。
时序数据模型 Time Series Data Model Metric 是一个对时序指标的统称，例如.：http_requests_total - the total number of HTTP requests received，就可以称为一条Metric
在Prometheus 中每一个时序序列(time-series)都是由于Metric Name 和Lable{Key-Value}组成的
例如：
1http_request_total{url=&#34;/ping&#34;,status=200} Metric Name： http_request_total 在Prometheus中Metric Name只能由大小写字母、数字、下划线、冒号组成，且不能以数字开头，对应正则为[a-zA-Z_:][a-zA-Z0-9_:]*。冒号保留，会在定义规则的时候使用。
Label Name: host 和status都属于Label. 在Prometheus中Label Name只能由大小写字母、数字、下划线组成，且不能以数字开头，对应的正则为[a-zA-Z_][a-zA-Z0-9_]*。一般_开头的Labels保留位系统内部使用。
Notation
Given a metric name and a set of labels, time series are frequently identified using this notion:
1&lt;Metric Name&gt;{&lt;Label Name&gt;=&lt;Label Value&gt;,...} For example, a time series with the mertric name api_http_request_total and the label method=&quot;POST&quot; and handler=&ldquo;message&rdquo;` could be written like this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://airren.github.io/posts/component/TimeSeries/prometheus_intro/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-11T13:41:16+08:00" />
<meta property="article:modified_time" content="2021-12-11T13:41:16+08:00" />


    
    
<meta name="description" content="「Prom」Prometheus 安装及使用简介" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    




</head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  


  




  
  
    
  
  



  
  
    
  
  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      
        <img src="/images/site/main-logo_hue3dcebd3233f4247380b642debb20e00_8242_42x0_resize_box_3.png" alt="Logo">
      ByteGopher</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      
      </ul>
    </div>
  </div>
  
  
    <img src="/images/site/main-logo_hue3dcebd3233f4247380b642debb20e00_8242_42x0_resize_box_3.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/site/inverted-logo_hu625a7b1b3d293b5088d5bed0b0ae5735_6060_42x0_resize_box_3.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts/" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/blog/" title="Blog">Blog</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloudnative/" title="CloudNative">CloudNative</a></li>
  

  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/component/">Infrastructure</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/component/TimeSeries/" title="TimeSeriesDB">TimeSeriesDB</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/kubernetes/" title="Kubernetes">Kubernetes</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/note_c/" title="Note C">Note C</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/note_go/" title="Note Go">Note Go</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/react/" title="React">React</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tips/" title="Tips">Tips</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/nodus/" title="Nodus">Nodus</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/interview/" title="Interview">Interview</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/life/" title="Life">Life</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux/" title="Linux">Linux</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/images/default-hero.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/airren_hua190a7ea0abcfe5733aac4e715353a6c_101835_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">Airren Ren</h5>
          <p>Saturday, December 11, 2021</p>
        </div>

        <div class="title">
          <h1>「Prom」Prometheus 安装及使用简介</h1>
        </div>
        
        <div class="taxonomy-terms">
          <ul style="padding-left: 0;">
            
          </ul>
        </div>
        
        <div class="post-content" id="post-content">
          <h2 id="prometheus-intro">Prometheus Intro</h2>
<p><a href="https://github.com/prometheus" target="_blank">Prometheus</a> 是<a href="https://soundcloud.com/" target="_blank">SoundCloud</a>开源的系统监控和报警工具集。通过Prometheus可以进行时序数据的采集、监控和报警。</p>
<h4 id="时序数据模型-time-series-data-model">时序数据模型 Time Series Data Model</h4>
<p>Metric 是一个对时序指标的统称，例如.：<code>http_requests_total</code> - the total number of HTTP requests received，就可以称为一条Metric</p>
<p>在Prometheus 中每一个时序序列(time-series)都是由于Metric Name 和Lable{Key-Value}组成的</p>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>http_request_total<span style="color:#f92672">{</span>url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/ping&#34;</span>,status<span style="color:#f92672">=</span>200<span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>Metric Name</strong>： <code>http_request_total</code> 在Prometheus中Metric Name只能由大小写字母、数字、下划线、冒号组成，且不能以数字开头，对应正则为<code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>。冒号保留，会在定义规则的时候使用。</p>
<p><strong>Label Name</strong>: <code>host</code> 和<code>status</code>都属于Label. 在Prometheus中Label Name只能由大小写字母、数字、下划线组成，且不能以数字开头，对应的正则为<code>[a-zA-Z_][a-zA-Z0-9_]*</code>。一般<code>_</code>开头的Labels保留位系统内部使用。</p>
<p><strong>Notation</strong></p>
<p>Given a metric name and a set of labels, time series are frequently identified  using this notion:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>&lt;Metric Name&gt;<span style="color:#f92672">{</span>&lt;Label Name&gt;<span style="color:#f92672">=</span>&lt;Label Value&gt;,...<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>For example, a time series with the mertric name <code>api_http_request_total</code> and the label <code>method=&quot;POST&quot;</code> and <code>handler</code>=&ldquo;message&rdquo;` could be written like this. This is the same notation that <a href="http://opentsdb.net/" target="_blank">OpenTSDB</a> uses.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>api_http_request_total<span style="color:#f92672">{</span>method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>, handler<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/messages&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>node_cpu_seconds_total<span style="color:#f92672">{</span>cpu<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>,mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;system&#34;</span><span style="color:#f92672">}</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>&lt;--- metric name------&gt;&lt;-----lable set------&gt;&lt;-timestamp -&gt;&lt;-value-&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>node_cpu_seconds_total<span style="color:#f92672">{</span>cpu<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>,mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;system&#34;</span><span style="color:#f92672">}</span>@1434417560938 195721.31
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#75715e"># timestamp 是毫秒级时间戳</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#75715e"># value 有且只有一个 float64</span>
</span></span></code></pre></div><blockquote>
<p><code>__</code> 作为前缀标签，只能在系统内部使用。 Prome底层实现指标名称是以<code>__name__=&lt;metric name&gt;</code>形式存储的，以下两种表达方式是相同的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>api_http_request_total<span style="color:#f92672">{</span>method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>, handler<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/messages&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#f92672">{</span>__name_<span style="color:#f92672">=</span>api_http_request_total, method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>, handler<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/messages&#34;</span><span style="color:#f92672">}</span>
</span></span></code></pre></div></blockquote>
<h2 id="component">Component</h2>
<blockquote>
<p>所有基础组件的安装都基于Docker。</p>
</blockquote>
<h3 id="prometheus">Prometheus</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>docker pull prom/prometheus
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>docker run -d -p 9090:9090 --name prometheus prom/prometheus
</span></span></code></pre></div><p>安装完成后可以访问<code>9090</code>端口，可以看到Prometheus管理页面。如下图为查询<code>go_routines</code>的情况。</p>
<p>查询当前数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#960050;background-color:#1e0010">GET http://devbox:9090/api/v1/query?query=go_goroutines&amp;time=1610127237.659
</span></span></span></code></pre></div><p><p class="md__image">








             <img src="image-20210109012636249.png" alt="image-20210109012636249" />



</p>
</p>
<p>查询历史数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#960050;background-color:#1e0010">GET http://devbox:9090/api/v1/query_range?query=go_goroutines&amp;start=1610126024.257&amp;end=1610126924.257&amp;step=3
</span></span></span></code></pre></div><p><p class="md__image">








             <img src="image-20210109013121175.png" alt="image-20210109013121175" />



</p>
</p>
<p>配置<code>/etc/prometheus/prometheus.yaml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#75715e"># my global config</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#f92672">global</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	<span style="color:#75715e"># 拉取target的默认时间间隔</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>  <span style="color:#f92672">scrape_interval</span>:     <span style="color:#ae81ff">15s</span> <span style="color:#75715e"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>  <span style="color:#f92672">evaluation_interval</span>: <span style="color:#ae81ff">15s</span> <span style="color:#75715e"># Evaluate rules every 15 seconds. The default is every 1 minute. 执行Rule的时间间隔</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>  <span style="color:#75715e"># scrape_timeout is set to the global default (10s). 拉取超时时间</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#75715e"># Alertmanager configuration</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#f92672">alerting</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>  <span style="color:#f92672">alertmanagers</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>  - <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    - <span style="color:#f92672">targets</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    	<span style="color:#75715e"># AlertManager ip:port  可以配置多个</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>      <span style="color:#75715e"># - alertmanager:9093  </span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span><span style="color:#75715e"># Load rules once and periodically evaluate them according to the global &#39;evaluation_interval&#39;.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span><span style="color:#f92672">rule_files</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>  <span style="color:#75715e"># - &#34;first_rules.yml&#34;   # 规则配置文件</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>  <span style="color:#75715e"># - &#34;second_rules.yml&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span><span style="color:#75715e"># A scrape configuration containing exactly one endpoint to scrape:</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span><span style="color:#75715e"># Here it&#39;s Prometheus itself.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span><span style="color:#f92672">scrape_configs</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>  <span style="color:#75715e"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>  - <span style="color:#f92672">job_name</span>: <span style="color:#e6db74">&#39;prometheus&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>    <span style="color:#75715e"># metrics_path defaults to &#39;/metrics&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    <span style="color:#75715e"># scheme defaults to &#39;http&#39;.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>    <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>    - <span style="color:#f92672">targets</span>: [<span style="color:#e6db74">&#39;localhost:9090&#39;</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>  - <span style="color:#f92672">job_name</span>: <span style="color:#e6db74">&#39;pushgateway&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    <span style="color:#75715e"># metrics_path defaults to &#39;/metrics&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>    <span style="color:#75715e"># scheme defaults to &#39;http&#39;.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>    <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>    - <span style="color:#f92672">targets</span>: [<span style="color:#e6db74">&#39;10.x.x.115:9091&#39;</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>  - <span style="color:#f92672">job_name</span>: <span style="color:#e6db74">&#39;alertmanager&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>    <span style="color:#75715e"># metrics_path defaults to &#39;/metrics&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>    <span style="color:#75715e"># scheme defaults to &#39;http&#39;.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>    <span style="color:#f92672">static_configs</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>    - <span style="color:#f92672">targets</span>: [<span style="color:#e6db74">&#39;10.x.x.115:9093&#39;</span>]
</span></span></code></pre></div><h3 id="pushgateway">PushGateway</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>docker pull prom/pushgateway
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>docker run -d --restart<span style="color:#f92672">=</span>always --name pushgateway -p 9091:9091 prom/pushgateway
</span></span></code></pre></div><p><p class="md__image">








             <img src="image-20210518175951312.png" alt="image-20210518175951312" />



</p>
</p>
<h3 id="alertmanager">AlertManager</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>docker run -d --restart<span style="color:#f92672">=</span>always --name alertmanager -p 9093:9093 prom/alertmanager
</span></span></code></pre></div><p>配置</p>
<p><strong>WebHook  Test</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">import</span> SimpleHTTPServer
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#f92672">import</span> SocketServer
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>PORT <span style="color:#f92672">=</span> <span style="color:#ae81ff">5001</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerHandler</span>(SimpleHTTPServer<span style="color:#f92672">.</span>SimpleHTTPRequestHandler):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_POST</span>(self):
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>      content_len <span style="color:#f92672">=</span> int(self<span style="color:#f92672">.</span>headers<span style="color:#f92672">.</span>getheader(<span style="color:#e6db74">&#39;content-length&#39;</span>, <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>      post_body <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>rfile<span style="color:#f92672">.</span>read(content_len)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>      print post_body
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>      self<span style="color:#f92672">.</span>send_response(<span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>      self<span style="color:#f92672">.</span>end_headers()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>Handler <span style="color:#f92672">=</span> ServerHandler
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>httpd <span style="color:#f92672">=</span> SocketServer<span style="color:#f92672">.</span>TCPServer((<span style="color:#e6db74">&#34;&#34;</span>, PORT), Handler)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>print <span style="color:#e6db74">&#34;serving at port&#34;</span>, PORT
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>httpd<span style="color:#f92672">.</span>serve_forever()
</span></span></code></pre></div><h2 id="prometheus-数据类型-metric-type">Prometheus 数据类型 Metric Type</h2>
<p>These are currently only differentiated in the client libraries and in the wire protocol. The prometheus server does not yet make user of  the type information and flattens all data into untyped time series.</p>
<h3 id="counter">Counter</h3>
<blockquote>
<p>A <em>counter</em> is a cumulative metric that represents a single <a href="https://en.wikipedia.org/wiki/Monotonic_function" target="_blank">monotonically increasing counter</a> whose value can only increase or be reset to zero on restart. For example, you can use a counter to represent the number of requests served, tasks completed, or errors.</p>
</blockquote>
<p><strong>只增不减，计数器</strong></p>
<p>Counter类型的指标相当于一个计数器，只增不减。除非Prometheus Client重启，将重新计数。例如：<code>http_request_total</code>。</p>
<p>例如：<code>node_cpu_seconds_total{cpu=&quot;0&quot;,mode=&quot;system&quot;}</code></p>
<p><strong>原始指标</strong></p>
<p><p class="md__image">








             <img src="image-20210520011848650.png" alt="image-20210520011848650" />



</p>
</p>
<p><strong><code>rate()</code>获取增长率</strong></p>
<p>rate始终大于0</p>
<p><p class="md__image">








             <img src="image-20210520012137113.png" alt="image-20210520012137113" />



</p>
</p>
<p><strong><code>topk()</code> 获取top k数据</strong></p>
<p><p class="md__image">








             <img src="image-20210520012542067.png" alt="image-20210520012542067" />



</p>
</p>
<h3 id="gauge">Gauge</h3>
<blockquote>
<p>A <em>gauge</em> is a metric that represents a single numerical value that can arbitrarily go up and down.</p>
<p>Gauges are typically used for measured values like temperatures or current memory usage, but also &ldquo;counts&rdquo; that can go up and down, like the number of concurrent requests.</p>
</blockquote>
<p>Gauge 相当于一个仪表盘，可增可减，是一个瞬时值。 例如：node_memory_MemFree（主机当前空闲的内容大小）、node_memory_MemAvailable（可用内存大小）都是Gauge类型的监控指标。</p>
<p>原始指标</p>
<p><p class="md__image">








             <img src="image-20210520013324083.png" alt="image-20210520013324083" />



</p>
</p>
<p><strong><code>delta()</code> 在一定时间内的差异</strong> 每个点与过去2h的差异</p>
<p><p class="md__image">








             <img src="image-20210520013449254.png" alt="image-20210520013449254" />



</p>
</p>
<p><p class="md__image">








             <img src="image-20210520013634932.png" alt="image-20210520013634932" />



</p>
</p>
<p><code>deriv()</code>计算样本线性回归模型</p>
<p><code>predict_linear(node_memory_MemFree_bytes[10h], 4*3600)</code> 预测未来4h的指标情况</p>
<h3 id="histogram">Histogram</h3>
<blockquote>
<p>A <em>histogram</em> samples observations (usually things like request durations or response sizes) and counts them in configurable buckets. It also provides a sum of all observed values.</p>
</blockquote>
<p>柱状图，用于观察结果采样，分组及统计。例如： 请求持续时间。是对一段时间内的数据进行采样，并能够对其指定区间以及总数进行统计。需要<strong>根据区间计算</strong>。</p>
<p>Histogram指标直接反应了在不同区间内样本的个数，区间通过标签le进行定义。</p>
<p><p class="md__image">








             <img src="image-20210523194755641.png" alt="image-20210523194755641" />



</p>
</p>
<h3 id="summary">Summary</h3>
<blockquote>
<p>Similar to a <em>histogram</em>, a <em>summary</em> samples observations (usually things like request durations and response sizes). While it also provides a total count of observations and a sum of all observed values, it calculates configurable quantiles over a sliding time window.</p>
</blockquote>
<p>类似Histogram, 用于表示一段时间内的数据采样结果，不是临时算出来的，结果早已存储。</p>
<p><p class="md__image">








             <img src="image-20210523194428037.png" alt="image-20210523194428037" />



</p>
</p>
<blockquote>
<p><strong>长尾问题</strong></p>
<p>如果大多数API请求都维持在100ms的响应时间范围内，而个别请求的响应时间需要5s，那么就会导致某些WEB页面的响应时间落到中位数的情况，而这种现象被称为长尾问题。</p>
<p>为了区分是平均的慢还是长尾的慢，最简单的方式就是按照请求延迟的范围进行分组。例如，统计延迟在0~10ms之间的请求数有多少而10~20ms之间的请求数又有多少。通过这种方式可以快速分析系统慢的原因。Histogram和Summary都是为了能够解决这样问题的存在，通过Histogram和Summary类型的监控指标，我们可以快速了解监控样本的分布情况。</p>
</blockquote>
<h3 id="数据存入prome">数据存入Prome</h3>
<p><p class="md__image">








             <img src="image-20210520011143434.png" alt="image-20210520011143434" />



</p>
</p>
<blockquote>
<p>存入Prom的点会自动添加Instance&amp;job 两个tag</p>
<p>实际打点
<p class="md__image">








             <img src="image-20210520011239384.png" alt="image-20210520011239384" />



</p>

数据存入Prom后会自动加上 <code>instance</code> &amp; <code>job</code> 两个tag</p>
</blockquote>
<h2 id="promql">PromQL</h2>
<p>PromQL是Prom的数据查询<code>DSL(Domain Specified Language)</code>语言。</p>
<p><strong>结果类型：</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Desc</th>
<th>Demo</th>
</tr>
</thead>
<tbody>
<tr>
<td>瞬时数据（Instant Vector）</td>
<td>包含一组TimeSeries，每个时序只有一个点</td>
<td><code>http_request_total</code></td>
</tr>
<tr>
<td>区间数据（Range Vector）</td>
<td>包含一组TimeSeries, 每个时序有多个点</td>
<td><code>http_request_total[5m]</code></td>
</tr>
<tr>
<td>纯量数据（Scalar）</td>
<td>只有一个数据，没有Time Series</td>
<td><code>count(http_request_total)</code></td>
</tr>
</tbody>
</table>
<p><strong>查询方式</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>logback_events_total<span style="color:#f92672">{</span>level<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;info&#34;</span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>查询支持正则匹配</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>http_request_total<span style="color:#f92672">{</span>code!<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;200&#34;</span><span style="color:#f92672">}</span>  <span style="color:#75715e"># code != 200</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>http_request_total<span style="color:#f92672">{</span>code<span style="color:#f92672">=</span>~<span style="color:#e6db74">&#34;2..&#34;</span><span style="color:#f92672">}</span>  <span style="color:#75715e"># code = 2xx</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>http_request_total<span style="color:#f92672">{</span>code!~<span style="color:#e6db74">&#34;2..&#34;</span><span style="color:#f92672">}</span>  <span style="color:#75715e"># code != 2xx</span>
</span></span></code></pre></div><p>其他查询</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#75715e"># 取整</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>floor<span style="color:#f92672">(</span>avg<span style="color:#f92672">(</span>http_request_total<span style="color:#f92672">{</span>code<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;200&#34;</span><span style="color:#f92672">}))</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>ceil<span style="color:#f92672">(</span>avg<span style="color:#f92672">(</span>http_request_total<span style="color:#f92672">{</span>code<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;200&#34;</span><span style="color:#f92672">}))</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#75715e"># 查看每秒数据</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>rate<span style="color:#f92672">(</span>http_request_total<span style="color:#f92672">[</span>5m<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span><span style="color:#75715e">#模糊查询： level=&#34;inxx</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>logback_events_total<span style="color:#f92672">{</span>level<span style="color:#f92672">=</span>~<span style="color:#e6db74">&#34;in..&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>logback_events_total<span style="color:#f92672">{</span>level<span style="color:#f92672">=</span>~<span style="color:#e6db74">&#34;in.*&#34;</span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>聚合查询：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#75715e"># count</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>count<span style="color:#f92672">(</span>logback_event_total<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#75715e"># sum</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>sum<span style="color:#f92672">(</span>logback_event_total<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#75715e"># avg</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>avg<span style="color:#f92672">(</span>logback_event_total<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#75715e"># topk</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>topk<span style="color:#f92672">(</span>2, logback_events_total<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#75715e"># irate  如查询过去5分钟的平均值 </span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>irate<span style="color:#f92672">(</span> logback_events_total<span style="color:#f92672">[</span>5m<span style="color:#f92672">])</span>
</span></span></code></pre></div><h2 id="reference">Reference</h2>
<p><a href="https://www.jianshu.com/p/93c840025f01" target="_blank">https://www.jianshu.com/p/93c840025f01</a></p>
<p><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-operators-v2" target="_blank">https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-operators-v2</a></p>
<p><a href="https://prometheus.io/docs/concepts/data_model/#notation" target="_blank">https://prometheus.io/docs/concepts/data_model/#notation</a></p>

        </div>

        
        <div class="row pl-3 pr-3">
        
        <div class="col-md-6 share-buttons">
        
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/airren/airren.github.io/edit/master/content/posts/component/TimeSeries/prometheus_intro.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  


<div class="row next-prev-navigator">
  
  
</div>

      <hr />

      
      
        
    











<script src="https://giscus.app/client.js"
        data-repo="Airren/airren.github.io"
        data-repo-id="R_kgDOIVgjKA"
        data-category="announcements"
        data-category-id="DIC_kwDOIVgjKM4CTB-z"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang=""
        crossorigin="anonymous"
        async>
</script>





      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#prometheus-intro">Prometheus Intro</a>
      <ul>
        <li>
          <ul>
            <li><a href="#时序数据模型-time-series-data-model">时序数据模型 Time Series Data Model</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#component">Component</a>
      <ul>
        <li><a href="#prometheus">Prometheus</a></li>
        <li><a href="#pushgateway">PushGateway</a></li>
        <li><a href="#alertmanager">AlertManager</a></li>
      </ul>
    </li>
    <li><a href="#prometheus-数据类型-metric-type">Prometheus 数据类型 Metric Type</a>
      <ul>
        <li><a href="#counter">Counter</a></li>
        <li><a href="#gauge">Gauge</a></li>
        <li><a href="#histogram">Histogram</a></li>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#数据存入prome">数据存入Prome</a></li>
      </ul>
    </li>
    <li><a href="#promql">PromQL</a></li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    












  
  
    
  

  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#recent-posts">Recent Posts</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#achievements">My Story</a>
                </li>
              
            
              
                
              
            
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
              
                <li><a href=mailto:renqiqiang@outlook.com target="_blank" rel="noopener">
                  <span><i class="fas fa-envelope"></i></span> <span>renqiqiang@outlook.com</span>
                </a></li>
              
            
          </ul>
        </div>
        
        
        
          
          <div class="col-md-4 col-sm-12">
            <p>Stay up to date with email notification</p>
              
              <form
                action="https://github.us1.list-manage.com/subscribe/post?u=19de52a4603135aae97163fd8&amp;amp;id=094a24c76e"
                method="post"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                class="validate"
                target="_blank"
                novalidate >
                <div class="form-group">
                  <input
                    type="email"
                    class="form-control"
                    id="mce-EMAIL"
                    name="EMAIL"
                    aria-describedby="emailHelp"
                    placeholder="Enter email"
                  />
                  <small id="emailHelp" class="form-text text-muted"
                    >By entering your email address, you agree to receive the newsletter of this website.</small
                  >
                </div>
                <button type="submit" class="btn btn-info">Submit</button>
              </form>
            
          </div>
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hugo-toha/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">© 2020-2022 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>



    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>









    
</body>
</html>
