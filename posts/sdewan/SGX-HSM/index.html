<!DOCTYPE html>
<html>
  <head>
    <title>Cloud-Native HSM based on Intel Software Guard(SGX)</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>

<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link rel="stylesheet" href="/google-fonts/Mulish/mulish.css"/>


<link rel="stylesheet" href="/fontawesome/css/all.min.css"/>







  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/favicon_hufa9bb061875e5783d83b75135c052e0b_6105_42x0_resize_box_3.png" />

<meta property="og:title" content="Cloud-Native HSM based on Intel Software Guard(SGX)" />
<meta property="og:description" content="Patent Cloud-Native HSM is a cloud-native Hardware Security Module(HSM) service that allows you to host encryption keys in the Intel Software Guard extension enclave and perform cryptographic operations accelerated by QAT in a cluster of HSM. You can manage the HSM resource with the Kubernetes customer resources, so you do not need to worry about scaling, managing, and clustering. You can leverage the Kubernetes&rsquo; function to provide the HSM to your service." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://airren.github.io/posts/sdewan/SGX-HSM/" /><meta property="article:section" content="posts" />




    
    
<meta name="description" content="Cloud-Native HSM based on Intel Software Guard(SGX)" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    

    
        
        

        
        

        
        
            <script
            data-goatcounter="https://bytegopher.goatcounter.com/count"
            async
            src="/js/goat-counter.js"
            ></script>
        

        
        
    




</head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  


  




  
  
    
  
  



  
  
    
  
  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      
        <img src="/images/site/main-logo_hue3dcebd3233f4247380b642debb20e00_8242_42x0_resize_box_3.png" alt="Logo">
      ByteGopher</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      
      </ul>
    </div>
  </div>
  
  
    <img src="/images/site/main-logo_hue3dcebd3233f4247380b642debb20e00_8242_42x0_resize_box_3.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/site/inverted-logo_hu625a7b1b3d293b5088d5bed0b0ae5735_6060_42x0_resize_box_3.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts/" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/blog/" title="Blog">Blog</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/cloudnative/" title="CloudNative">CloudNative</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/component/">Infrastructure</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/component/TimeSeries/" title="TimeSeriesDB">TimeSeriesDB</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/kubernetes/" title="Kubernetes">Kubernetes</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/note_c/" title="Note C">Note C</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/note_go/" title="Note Go">Note Go</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/react/" title="React">React</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tips/" title="Tips">Tips</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/nodus/" title="Nodus">Nodus</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/interview/" title="Interview">Interview</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/life/" title="Life">Life</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/linux/" title="Linux">Linux</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(/images/default-hero.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/airren_hua190a7ea0abcfe5733aac4e715353a6c_101835_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">Airren Ren</h5>
          <p>Monday, January 1, 1</p>
        </div>

        <div class="title">
          <h1>Cloud-Native HSM based on Intel Software Guard(SGX)</h1>
        </div>
        
        <div class="taxonomy-terms">
          <ul style="padding-left: 0;">
            
          </ul>
        </div>
        
        <div class="post-content" id="post-content">
          <h2 id="patent">Patent</h2>
<p>Cloud-Native HSM is a cloud-native Hardware Security Module(HSM) service that allows you to host encryption keys in the Intel Software Guard extension enclave and perform cryptographic operations accelerated by QAT in a cluster of HSM. You can manage the HSM resource with the Kubernetes customer resources, so you do not need to worry about scaling, managing, and clustering. You can leverage the Kubernetes&rsquo; function to provide the HSM  to your service.</p>
<p>This is the architecture of the Cloud Native HSM.</p>
<p><p class="md__image">







<img src="sgx-hsm.png" alt="sgx-hsm" />



</p>
<p class="md__image">







<img src="" alt="" />



</p>
</p>
<ol>
<li>If the application needs an HSM device to create a secure connection with a remote host,  you can deploy an HSM agent as a sidecar to work with the application Pod.</li>
<li>And then, the application can call the HSM controller to generate a Key Pair and a CSR.</li>
<li>The HSM controller received the request and then call the corresponding HSM manager to really create a Key Pair and Generate a CSR from the  CTK for Intel SGX.</li>
<li>After that, the application can take the CSR to the remote CA center to get a certificate.</li>
<li>The application can put the received certificate to the SGX enclave and cross the HSM controller through the HSM manager.</li>
<li>After getting the certificate, the Application can call the Crypoki through the PKCS#11 client and PKCS#11 server to the CTK.</li>
</ol>
<p>Advantage:</p>
<ul>
<li>HSM agent works as a sidecar, and it won&rsquo;t need to make any change in the application code. The application can use the Unix socket to involve the HSM. It keeps the safety of the HSM.</li>
<li>HSM controller leverages the Kubernetes function to manage the HSM cluster, it&rsquo;s convenient</li>
<li>The SGX enhances the security of the data and private key.</li>
</ul>
<p>If they use the CTK for Intel SGX as a sidecar, and use the Unix socket to forward the PKCS#11 service between the Pod they will hit the patent.</p>
<h2 id="aws-cloud-hsm">AWS Cloud HSM</h2>
<p>What is Cloud Hardware Security Module(HSM)?</p>
<p>A hardware security module(HSM) is a computing device that <strong>processes cryptographic operations</strong> and <strong>provides secure storage for cryptographic keys.</strong></p>
<p>AWS Cloud HSM is a cloud-based hardware security module (HSM) that enables you to genereate and use you own encryption keys.</p>
<p>Cloud HSM is a compliant with FIPS 140-2 level 3 (The Federal Information Processing Stanard Publication 140-2)</p>
<p>It automates administrative tasks like hardware provisioning, sofeware pathcing, high-availability, and backups</p>
<p>Applications can integrate with Cloud HSM using PKCS#11, Java Cryptography Extensions(JCE), and Microsoft CryptoNG (CNG) API libraries.</p>
<p>CloudHSM can scale quickly on-demand with no up-front costs.</p>
<h3 id="cloud-hsm-cluster">Cloud HSM Cluster</h3>
<img src="SGX-HSM/image-20220614142811660.png" alt="image-20220614142811660" style="zoom:50%;" />
<p>AWS Cloud HSM provides hardware securtiy modules (HSM) in a cluster.</p>
<p>A  cluster is one logical HSM.</p>
<p>To interact with the HSMs in a cluster, you need the AWS Cloud HSM Client software.</p>
<p>Client can be installed on Amazon EC2 instances, known as client instances, that reside in the same VPC as the HSM ENIs.</p>
<p>When you perform a task or operation on the one HSM in  a cluster, the other HSM in that cluster are automatically updated.</p>
<p>You can create a cluster that has from 1 to 28 HSMs (the defaut limit is 6 HSMs per AWS account per AWS region.)</p>
<img src="SGX-HSM/image-20220614143402298.png" alt="image-20220614143402298" style="zoom:50%;" />
<h3 id="benefits">Benefits</h3>
<ul>
<li>Generate and manager cryptographic keys</li>
<li>Cluster based makes it easy to load balance and scale</li>
<li>API based integration for Applications</li>
<li>Integrates with AWS KMS to create custom key stores</li>
</ul>
<h2 id="google-cloud-hsm">Google Cloud HSM</h2>
<h3 id="cloud-hsm">Cloud HSM</h3>
<p>Cavium Liquid Security HSM</p>
<p>Why Cloud HSM</p>
<p>Complicance</p>
<ul>
<li>FIPS 140-2 level 3 certified HSMs</li>
</ul>
<p>Regionalization</p>
<ul>
<li>HSM keys are cryptographically bound to region</li>
<li>Avaiable in all GCP Regions</li>
<li>Support for multi-regions</li>
</ul>
<p>No application changes for Cloud KMS customers</p>
<ul>
<li>Same API and client libraries as Cloud KMS</li>
</ul>
<p>It leverages the exact same API as Cloud KMS,  what that mean is that  if you know how to use cloud KMS, then you know howe to use Cloud HSM.</p>
<p>Key Fearures:</p>
<ul>
<li>Global and multi-region support</li>
<li>Attestation statement
<ul>
<li>confidence your keys are hardware protected</li>
<li>Cryptographically signed statement provided by the HSM verifying the creation of the key si within an HSM boundary and non-exportable</li>
<li>statement can be verified manually or through a script</li>
<li>verify key attriburtes</li>
</ul>
</li>
<li>CMEK integration</li>
</ul>
<blockquote>
<p>The HSM is bind with Vm not bind with application Pod</p>
<p>Tenant Separation</p>
</blockquote>
<h3 id="summary">Summary</h3>
<ul>
<li>Cloud HSM provides a scalable, reliable, and low-maintenance service</li>
<li>Provides a modern, intergrated approach to  administrative control and tenant isolation</li>
<li>Keys can be effortlessly created in multi-regions or event a global region.</li>
<li>HSM keys can be used to seamlessly protect your data-at-rest with CMEK services</li>
<li>Look for an upcomming Cloud HSM white paper</li>
</ul>
<h2 id="what-is-a-cloud-hardware-security-module">What is a Cloud Hardware Security Module</h2>
<p>The CloudHSM helps you meet corporate, contractual and regulatory compliance requirements for data security by using dedicated Hardware Secutiry Module(HSM) applicances withing the cloud.</p>
<p>very critical area in the cryptography, Stand out on CV, fundamental topic to learn for cloud security role.</p>
<h1 id="1--title-of-the-invention">1.  Title of the invention</h1>
<p>Cloud Native HSM based on Intel Software Guard Extension (SGX) And QAT</p>
<h1 id="2--names-of-the-inventors">2.  names of the inventors</h1>
<p>Ren, Qiang 11717682</p>
<p>Ying, Ruoyu</p>
<p>Huang, Jiahao</p>
<h1 id="3--technology-background">3.  TECHNOLOGY BACKGROUND</h1>
<h2 id="31---problem-definition---what-technical-problem-did-you-solve">3.1   Problem Definition - What technical problem did you solve?</h2>
<p>There are many scenarios that need Hardware security module (HSM) to protect transactions, identities, and applications. HSM is excel at storing cryptographic keys and provisioning encryption, decryption, authentication, and digital signing service for a wide range of applications. The dilemma here is that most cloud native services are hard to co-work with the traditional HSM that are physical devices. In the cloud native scenario, most applications need the capability of scaling and dynamic migration, but the physical HSM is hard to meet the requirement.</p>
<p>Cloud-Native HSM is a cloud-native Hardware Security Module service that allows you to host encryption keys or data in the Intel Software Guard extensions (SGX) enclave and perform cryptographic operations accelerated by Quick Assistant Technology (QAT) in a cluster of HSM. You can manage the HSM resource with the Kubernetes customer resources, so you do not need to worry about scaling, managing, and clustering. You can leverage the IA (Intel Architecture) features which are SGX to keep the private data security and QAT to accelerate the data encryption.</p>
<h2 id="32---previous-solutions-if-any">3.2   Previous Solutions (if any):</h2>
<p>Currently, there are two main types of cloud HSM. One is to provide users with the right to use HSM as a single tenant on the physical level, such as Microsoft Azure Dedicated HSM. The cloud providers deploy HSM in different data centers. When the customer needs it, the cloud providers preconfigure HSM and connect it to the customer&rsquo;s virtual network as a cloud HSM so that only the customer can access it. After the customer accesses the cloud HSM for the first time and changes the password, the cloud providers will no longer have the management rights of this cloud HSM. The customer can have full control and management rights.</p>
<p>This is a highly specialized service. This service is very secure and easy to migrate programs that directly access physical HSM. The service can meet the unique needs of some large organizations. However, due to excessive cost, complex configuration, inconvenient scaling, and resource waste, it is not suitable for many customers.</p>
<p>The second is to provide virtual HSM for users, such as AWS Cloud HSM. The cloud providers generate multiple virtual HSM on the physical HSM through virtualization technology, and users can obtain the access permission of the virtual HSM as a single tenant. Users can easily start and stop virtual HSM, build Cloud HSM clusters, and automatically synchronize virtual HSM by using relevant Cloud HSM API in their own virtual network. The users configure the corresponding client on their own virtual machine instances, and then applications on the virtual machine instances can use the virtual HSM cluster through a secure network connection between client and server.</p>
<p>This is the current mainstream service. Customers can quickly build virtual HSM clusters through the various APIs provided by cloud providers. In addition to this, customers can quickly scale clusters on demand. However, this service will also bring a lot of costs, which is often unacceptable for those who want to use the cloud to reduce costs. Secondly, the solution provides services to virtual machine instances through a virtual HSM cluster, which does not conform to the idea of cloud native. Managing virtual HSM clusters and secure Internet connections requires the use of dedicated resources and integration, so the operation capability has also proved to be a problem.</p>
<p>​</p>
<p>Figure 1: Architecture of AWS Cloud HSM</p>
<h1 id="4--overview-of-the-invention">4.  OVERVIEW OF THE INVENTION</h1>
<h2 id="41---short-summary--in-1-3-sentences-describe-the-core-of-your-solution">4.1   Short summary – In 1-3 sentences, describe the core of your solution.</h2>
<p>a.    Cloud-Native HSM provides HSM service for applications only with SGX feature of CPU, and the QAT is optional for acceleration, do not need to plug in another physical device to the machine.</p>
<p>b.    HSM agents work as a sidecar to provide Cryptoki for users’ application, which work as a usual physical device without code change for the application.</p>
<p>c.    The private key and sensitive data stored in the SGX enclave, it’s safety.</p>
<p>d.    The cryptographic operations can leverage the QAT to accelerate the process.</p>
<p>e.    Cloud-Native HSM is a Kubernetes native service which has capability of scaling, migrating and reliability.</p>
<h2 id="42---advantages--in-1-3-sentences-describe-the-value-of-the-invention-to-intel-or-to-our-customers">4.2   Advantages – In 1-3 sentences, describe the value of the invention to Intel or to our customers.</h2>
<p>In general, the Cloud Native HSM agent provides HSM service based on the Intel Software Guard Extensions (SGX) that keep the private key in the enclave and only the applications pod can access it which keeps the sensitive data’s security. And the HSM agent can scale and migrate with the application pod, which is convenient. What’s more, Cloud Native HSM can leverage the QAT to accelerate the cryptographic operations.</p>
<p>Compared with the Cloud HSM, there is a risk for the transport between the application and the Cloud HSM. But, when using the Cloud HSM, the data will not leave the application Pod.</p>
<p>Cloud native HSM is especially suitable for the pod whose life cycle is consistent with that of confidential information, such as protecting the private key for a mutual SSL connection between to pod in service mesh from administrator attacks.</p>
<p>Cloud native HSM can also be used in combination with other security devices. For example, we can copy an existing private key from a Cloud HSM to the Cloud Native HSM, but not suggested.</p>
<p>For customers, the Cloud Native HSM provides them with a flexibility HSM device which can be managed by Kubernetes customer resources. It makes it much more convenient to use HSM in the cloud native application and much more secure for their application. The application can involve the Cloud Native HSM without code change.</p>
<p>For Intel, it is a good chance to promote the SGX technology to provide security service for most cloud native applications and promote the QAT technology to accelerate the encryption and decryption process. Thus, it is also helpful to promote our Sapphire Rapids Platform.</p>
<h1 id="5--detectability">5.  Detectability</h1>
<h2 id="51---please-describe-in-detail-how-your-invention-is-detectable-in-a-final-product">5.1   Please describe in detail how your invention is detectable in a final product.</h2>
<h3 id="a-----if-your-invention-results-in-a-specific-structural-feature-please-describe-the-appearance-of-that-feature-eg-include-semtems-of-actual-features-if-available">A.     If your invention results in a specific structural feature please describe the appearance of that feature (e.g., include SEM/TEMs of actual features if available).</h3>
<h3 id="b-----if-there-are-visual-inspection-andor-reverse-engineering-techniques-that-can-be-used-to-identify-the-feature-please-describe-them">B.     If there are visual inspection and/or reverse engineering techniques that can be used to identify the feature, please describe them.</h3>
<p>If they use CTK for SGX work as a sidecar pod and forward the HSM token to the application pod through the Unix socket.</p>
<h3 id="c-----if-documentation-such-as-product-literature-would-show-usage-of-the-invention-please-let-us-know-what-to-look-for-in-that-regard">C.     If documentation such as product literature would show usage of the invention, please let us know what to look for in that regard.</h3>
<p>The cloud native application that wants to use HSM to provide a dedicated, secure, tamper-resistant environment to protect cryptographic keys and data, and to automate the lifecycle of those same keys. For example, the mutual SSL connection between to pod in service mesh like Istio.</p>
<h1 id="6--details-of-the-invention">6.  DETAILS OF THE INVENTION</h1>
<p>6.1   Provide details that help us fully understand your invention, including details on how you solved the technical problem, and at least one figure. You may also provide flowcharts, graphs, slides, or data to support your description. Where appropriate, please provide and explain any empirical support, such as experimental data or) simulation results, that can demonstrate the viability of your invention.</p>
<p>SoftHSM with Intel SGX/QAT: This works as a software HSM to provide enhancing the security of data and key protection applications by exposing interfaces. That runs the key generation and cryptographic operations securely inside an Intel Software Guard Extensions (SGX) enclave. And this can leverage the QAT to accelerate the cryptographic operations.</p>
<p>HSM Agent: HSM Agent is an operator of the HSM customer resource which aims at managing the local SoftHSM, to create tokens, create key pairs, generate CSR, add certificate to the SGX enclave, and even add an existing private key to the SoftHSM.</p>
<p>HSM Controller: The HSM Controller monitors the changing of the customer resource of HSM and calls the HSM Agent to apply the change of the resources.</p>
<p>PKCS#11 Client/Server: PKCS#11 Server is used to forward the HSM token in the HSM agent container to the application pod through Unix socket. PKCS#11 Client connects to the PKCS#11 Server by the Unix socket and provides Cryptoki API for the application. For the application, the PKCS#11 Client and server is transparent. The application calls the HSM token through the PKCS#11 API like locally.</p>
<p>Figure 2: Architecture of Cloud Native HSM</p>
<p>Figure 1 is the architecture of the Cloud Native HSM.</p>
<p>The default workflow is as follows.</p>
<p>\1.    If the application needs an HSM device to create a secure connection with a remote host, you can deploy an HSM agent as a sidecar reside the application Pod.</p>
<p>\2.    And then, the application can call the Kubernetes API to create a customer resource of HSM Key Pair as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">soft-hsm-sgx.intel.com/v1alpha1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">SoftHSMKeyPair</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">keypair-1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">keypair-1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>  <span style="color:#f92672">applicationPod</span>: <span style="color:#ae81ff">application-1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>  <span style="color:#f92672">token</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    <span style="color:#f92672">lable</span>: <span style="color:#e6db74">&#34;token-1&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    <span style="color:#f92672">slot</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    <span style="color:#f92672">soPin</span>: <span style="color:#ae81ff">12345678</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    <span style="color:#f92672">pin</span>: <span style="color:#ae81ff">12345678</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>  <span style="color:#f92672">cert</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    <span style="color:#f92672">keyPair</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>      <span style="color:#f92672">keyType</span>: <span style="color:#e6db74">&#34;rsa:2048&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>      <span style="color:#f92672">lable</span>: <span style="color:#e6db74">&#34;keypair-1&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>      <span style="color:#f92672">id</span>: <span style="color:#e6db74">&#34;0001&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    <span style="color:#f92672">subject</span>: <span style="color:#e6db74">&#34;/CN=application-1&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">soft-hsm-sgx.intel.com/v1alpha1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">SoftHSMKeyPair</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">keypair-1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">keypair-1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>  <span style="color:#f92672">applicationPod</span>: <span style="color:#ae81ff">application-1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>  <span style="color:#f92672">token</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    <span style="color:#f92672">lable</span>: <span style="color:#e6db74">&#34;token-1&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>    <span style="color:#f92672">slot</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>    <span style="color:#f92672">soPin</span>: <span style="color:#ae81ff">12345678</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>    <span style="color:#f92672">pin</span>: <span style="color:#ae81ff">12345678</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>  <span style="color:#f92672">cert</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>    <span style="color:#f92672">keyPair</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>      <span style="color:#f92672">keyType</span>: <span style="color:#e6db74">&#34;rsa:2048&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>      <span style="color:#f92672">lable</span>: <span style="color:#e6db74">&#34;keypair-1&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>      <span style="color:#f92672">id</span>: <span style="color:#e6db74">&#34;0001&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span><span style="color:#f92672">subject</span>: <span style="color:#e6db74">&#34;/CN=application-1&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span><span style="color:#f92672">csr</span>: <span style="color:#ae81ff">CZ01fouDJIXLehgw62ol7TsuKC1CvUkVUiI= </span>
</span></span></code></pre></div><p>apiVersion: soft-hsm-sgx.intel.com/v1alpha1  kind: SoftHSMKeyPair  metadata:   name: keypair-1   namespace: default  spec:   name: keypair-1   applicationPod: application-1   token:    lable: &ldquo;token-1&rdquo;    slot: 0    soPin: 12345678    pin: 12345678   cert:    keyPair:     keyType:  &ldquo;rsa:2048&rdquo;     lable:  &ldquo;keypair-1&rdquo;     id: &ldquo;0001&rdquo;    subject:  &ldquo;/CN=application-1&rdquo;</p>
<p>\3.    After creating the customer resource, the HSM controller will call the specific HSM agent according the <em>applicationPod</em> field to generate a Key Pair in the SGX enclave, and a CSR is created write back the <em>SoftHSMKeyPair</em> for the certificate request, which is a base64 encode string.</p>
<p>apiVersion: soft-hsm-sgx.intel.com/v1alpha1  kind: SoftHSMKeyPair  metadata:   name: keypair-1   namespace: default  spec:   name: keypair-1   applicationPod: application-1   token:    lable: &ldquo;token-1&rdquo;    slot: 0    soPin: 12345678    pin: 12345678   cert:    keyPair:     keyType:  &ldquo;rsa:2048&rdquo;     lable:  &ldquo;keypair-1&rdquo;     id: &ldquo;0001&rdquo;  subject:  &ldquo;/CN=application-1&rdquo;  csr: CZ01fouDJIXLehgw62ol7TsuKC1CvUkVUiI=</p>
<p>\4.    When the application pod found the CSR field is not empty, the applications can call the remote CA center to get a certificate for themselves.</p>
<p>\5.    The application can put the received certificate to the <em>pem</em> filed with base64 encode in the customer resource of <em>SoftHSMKeyPair</em>. And then, the HSM controller will write the cert to the SoftHSM in SGX enclave cross the HSM controller and the HSM manager.</p>
<p>apiVersion: soft-hsm-sgx.intel.com/v1alpha1  kind: SoftHSMKeyPair  metadata:   name: keypair-1   namespace: default  spec:   name: keypair-1   applicationPod: application-1   token:    lable: &ldquo;token-1&rdquo;    slot: 0    soPin: 12345678    pin: 12345678   cert:    keyPair:     keyType:  &ldquo;rsa:2048&rdquo;     lable:  &ldquo;keypair-1&rdquo;     id: &ldquo;0001&rdquo;  subject: &ldquo;/CN=application-1&rdquo;  csr: CZ01fouDJIXLehgw62ol7TsuKC1CvUkVUiI=  pem: y9EelphCnI2MFUvbVZ3YUl3aHhwcHRaY2g2OFQ2TGJyQml2dk9xSFA</p>
<p>\6.    Finally, the application can call the Cryptoki through the PKCS#11 client and PKCS#11 server to the SoftHSM. The PKCS#11 client and PKCS#11 server are connected by the Unix socket mounted in a shared point. The application can offload the cryptographic operations to the HSM Agent container which use SGX for keep the security and QAT for acceleration.</p>
<p>If you already have an existing keypair and cert, you can use the Cloud Native HSM as follows.</p>
<p>\1.    If the application needs an HSM device to create a secure connection with a remote host, you can deploy an HSM agent as a sidecar reside the application Pod.</p>
<p>\2.    The application can call the Kubernetes api to create a customer resource SoftHSMKeyPair with existing keypair and cert which are base64 encoded like as follows:</p>
<p>apiVersion: soft-hsm-sgx.intel.com/v1alpha1  kind: SoftHSMKeyPair  metadata:   name: keypair-1   namespace: default  spec:   name: keypair-1   applicationPod: application-1   token:    lable: &ldquo;token-1&rdquo;    slot: 0    soPin: 12345678  pin: 12345678  privateKey: VZ3YUl3aHhwcHRaY2g2OFQ2  publicKey: 7TsuKC1CvUkVUi   cert:    keyPair:     keyType:  &ldquo;rsa:2048&rdquo;     lable:  &ldquo;keypair-1&rdquo;     id: &ldquo;0001&rdquo;  subject: &ldquo;/CN=application-1&rdquo;  csr: CZ01fouDJIXLehgw62ol7TsuKC1CvUkVUiI=      pem: y9EelphCnI2MFUvbVZ3YUl3aHhwcHRaY2g2OFQ2TGJyQml2dk9xSFA</p>
<p>\3.    After creating the customer resource, the HSM controller will call the specific HSM agent according the applicationPod field to  create a Key Pair with the existing key, and save the certificate in the SGX enclave.</p>
<p>\4.    Finally, the application can call the Cryptoki through the PKCS#11 client and PKCS#11 server to the SoftHSM. The PKCS#11 client and PKCS#11 server are connected by the Unix socket mounted in a shared point. The application can offload the cryptographic operations to the HSM Agent container which use SGX for keep the security and QAT for acceleration.</p>
<p>TODO:</p>
<p>-     Add load balance to this architecture</p>
<p>-     QAT accelerate</p>
<p>-     Attestation</p>
<p>-     Dedicated Device is expensive</p>

        </div>

        
        <div class="row pl-3 pr-3">
        
        <div class="col-md-6 share-buttons">
        
          </div>

        
        
          
            
          
          <div class="col-md-6 btn-improve-page">
             
               <a href="https://github.com/airren/airren.github.io/edit/master/content/posts/sdewan/SGX-HSM.md" title="Improve this page" target="_blank" rel="noopener">
            
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        
        </div>



      
      <hr />
        







  





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  


<div class="row next-prev-navigator">
  
  
</div>

      <hr />

      
      
        
    











<script src="https://giscus.app/client.js"
        data-repo="Airren/airren.github.io"
        data-repo-id="R_kgDOIVgjKA"
        data-category="announcements"
        data-category-id="DIC_kwDOIVgjKM4CTB-z"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang=""
        crossorigin="anonymous"
        async>
</script>





      

      
      

      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#patent">Patent</a></li>
    <li><a href="#aws-cloud-hsm">AWS Cloud HSM</a>
      <ul>
        <li><a href="#cloud-hsm-cluster">Cloud HSM Cluster</a></li>
        <li><a href="#benefits">Benefits</a></li>
      </ul>
    </li>
    <li><a href="#google-cloud-hsm">Google Cloud HSM</a>
      <ul>
        <li><a href="#cloud-hsm">Cloud HSM</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
    <li><a href="#what-is-a-cloud-hardware-security-module">What is a Cloud Hardware Security Module</a></li>
  </ul>

  <ul>
    <li><a href="#31---problem-definition---what-technical-problem-did-you-solve">3.1   Problem Definition - What technical problem did you solve?</a></li>
    <li><a href="#32---previous-solutions-if-any">3.2   Previous Solutions (if any):</a></li>
  </ul>

  <ul>
    <li><a href="#41---short-summary--in-1-3-sentences-describe-the-core-of-your-solution">4.1   Short summary – In 1-3 sentences, describe the core of your solution.</a></li>
    <li><a href="#42---advantages--in-1-3-sentences-describe-the-value-of-the-invention-to-intel-or-to-our-customers">4.2   Advantages – In 1-3 sentences, describe the value of the invention to Intel or to our customers.</a></li>
  </ul>

  <ul>
    <li><a href="#51---please-describe-in-detail-how-your-invention-is-detectable-in-a-final-product">5.1   Please describe in detail how your invention is detectable in a final product.</a>
      <ul>
        <li><a href="#a-----if-your-invention-results-in-a-specific-structural-feature-please-describe-the-appearance-of-that-feature-eg-include-semtems-of-actual-features-if-available">A.     If your invention results in a specific structural feature please describe the appearance of that feature (e.g., include SEM/TEMs of actual features if available).</a></li>
        <li><a href="#b-----if-there-are-visual-inspection-andor-reverse-engineering-techniques-that-can-be-used-to-identify-the-feature-please-describe-them">B.     If there are visual inspection and/or reverse engineering techniques that can be used to identify the feature, please describe them.</a></li>
        <li><a href="#c-----if-documentation-such-as-product-literature-would-show-usage-of-the-invention-please-let-us-know-what-to-look-for-in-that-regard">C.     If documentation such as product literature would show usage of the invention, please let us know what to look for in that regard.</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    












  
  
    
  

  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer id="footer" class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#recent-posts">Recent Posts</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="https://airren.github.io/#achievements">My Story</a>
                </li>
              
            
              
                
              
            
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
              
                <li><a href=mailto:renqiqiang@outlook.com target="_blank" rel="noopener">
                  <span><i class="fas fa-envelope"></i></span> <span>renqiqiang@outlook.com</span>
                </a></li>
              
            
          </ul>
        </div>
        
        
        
          
          <div class="col-md-4 col-sm-12">
            <p>Stay up to date with email notification</p>
              
              <form
                action="https://github.us1.list-manage.com/subscribe/post?u=19de52a4603135aae97163fd8&amp;amp;id=094a24c76e"
                method="post"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                class="validate"
                target="_blank"
                novalidate >
                <div class="form-group">
                  <input
                    type="email"
                    class="form-control"
                    id="mce-EMAIL"
                    name="EMAIL"
                    aria-describedby="emailHelp"
                    placeholder="Enter email"
                  />
                  <small id="emailHelp" class="form-text text-muted"
                    >By entering your email address, you agree to receive the newsletter of this website.</small
                  >
                </div>
                <button type="submit" class="btn btn-info">Submit</button>
              </form>
            
          </div>
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hugo-toha/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">© 2020-2022 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>



    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>









    
</body>
</html>
