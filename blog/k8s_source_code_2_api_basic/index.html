<!DOCTYPE html>
<html>
  <head>
    <title>Kubernetes API Basic</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>
<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />




  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/favicon_hufa9bb061875e5783d83b75135c052e0b_6105_42x0_resize_box_3.png" />

<meta property="og:title" content="Kubernetes API Basic" />
<meta property="og:description" content="Controller and Operator In this section you&rsquo;ll learn about controllers and operators in Kubernetes and how they work.
The API server has the following core responsibilities:
To serve the Kubernetes API. This API is used cluster-internally by the master components, the worker nodes, and you Kubernetes-native apps, as well as externally by clients such as kubectl. To proxy cluster components, such as the Kubernetes dashboard, or stream logs, services ports, or serve kubectl exec sessions." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://airren.github.io/blog/k8s_source_code_2_api_basic/" /><meta property="article:section" content="blog" />




    
    
<meta name="description" content="Kubernetes API Basic" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    




































<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
    <div class="container">
        <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
            <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="/">
            
            <img src="/images/site/main-logo_hue3dcebd3233f4247380b642debb20e00_8242_42x0_resize_box_3.png" alt="Logo">
            ByteGopher</a>
        <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
            <ul class="navbar-nav ml-auto">
                
                <li class="nav-item">
                    <a class="nav-link" id="blog-link" href="/go_note">Go Note</a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" id="blog-link" href="/blog">Blog</a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link" href="https://www.github.com/airren">Github</a>
                </li>
                
                
            </ul>
        </div>
    </div>
    
    
    <img src="/images/site/main-logo_hue3dcebd3233f4247380b642debb20e00_8242_42x0_resize_box_3.png" class="d-none" id="main-logo" alt="Logo">
    
    
    <img src="/images/site/inverted-logo_hu625a7b1b3d293b5088d5bed0b0ae5735_6060_42x0_resize_box_3.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
    
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading">
              <a href="/go_note" data-filter="all">Posts</a>:
              <a href="/blog" data-filter="all">Kubernetes API Basic</a>
            </li>
            <div class="subtree">
              
  
  
  
  
  
    
    <li><a class="" href="/note_go/" title="Go Note">Go Note</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/CloudNative/" title="CloudNative">CloudNative</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/component/" title="基础组件">基础组件</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/blog/" title="Blog">Blog</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/datastruct/" title="DataStructs">DataStructs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/english-learning/" title="English-learnings">English-learnings</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/interview/" title="Interviews">Interviews</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/life/" title="Lives">Lives</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/6.824/" title="MIT 6.824">MIT 6.824</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/nodus/" title="Nodus">Nodus</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/note_c/" title="Note_cs">Note_cs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/notes/" title="Notes">Notes</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/os/" title="Os">Os</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/" title="Posts">Posts</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/react/" title="Reacts">Reacts</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/sdewan/" title="Sdewans">Sdewans</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/tech/" title="Teches">Teches</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/tools/" title="Tools">Tools</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://airren.github.io/images/default-hero.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/airren_hua190a7ea0abcfe5733aac4e715353a6c_101835_120x120_fit_box_3.png' alt="Author Image">
          <h5 class="author-name">Airren Ren</h5>
          <p>January 1, 0001</p>
        </div>

        <div class="title">
          <h1>Kubernetes API Basic</h1>
        </div>
        
        <div class="taxonomy-terms">
            <ul>
            
          </ul>
        </div>
        
        <div class="post-content" id="post-content">
          <h2 id="controller-and-operator">Controller and Operator</h2>
<p>In this section you&rsquo;ll learn about <code>controllers</code> and <code>operators</code> in Kubernetes and how they work.</p>
<p>The API server has the following core responsibilities:</p>
<ul>
<li>To serve the Kubernetes API.  This API is used cluster-internally by the master components, the worker nodes, and you Kubernetes-native apps, as well as externally by clients such as <code>kubectl</code>.</li>
<li>To proxy cluster components, such as the Kubernetes dashboard, or stream logs, services ports, or serve <code>kubectl exec</code> sessions.</li>
</ul>
<p>Per the Kubernetes glossary, a controller implements a control loop, watching the shared state of the cluster throught the API Server and making changes in an attempt to move the current state toward the desired state.</p>
<p>Befor we dive into the controller&rsquo;s inner working, let&rsquo;s define our terminology:</p>
<ul>
<li>Controllers can act on core resources such as deployments or services, which are typically part of Kubernetes controller manager in the control plane, or can watch and manipulate user-defined custome resources.</li>
<li>Operatirs are controllers that encode some opetational knowledge, such as application lifecycle management, along with the custome resources.</li>
</ul>
<h3 id="the-control-loop">The Control Loop</h3>
<p>In general, the control loop looks as follows:</p>
<ol>
<li>Read the state of resources, preferably event-driven.</li>
<li>Change the state of the objects in the cluster or the cluster-external world. For example, launch a pod, create a network endpoint, or query a cloud API.</li>
<li>Update status of the resource in step 1 via the API server in etcd.</li>
<li>Repeat cycle; return to step 1.</li>
</ol>
<p>From an architectural point of view, a controller typically uses the following data structures.</p>
<h4 id="informers">Informers</h4>
<p>Informers watch the desired state of the resources in a scalable and sustainable fashion. They also implement a resync mechanism that enforces periodic reconciliation, and is often used to make sure that the cluster state and the assumend state cached in memory do not drift (e.g.,  due bugs or network issues).</p>
<h2 id="the-api-server">The API Server</h2>
<h3 id="the-http-interface-of-the-api-server">The HTTP Interface of the API Server</h3>
<h3 id="api-terminology">API Terminology</h3>
<p>Before we get into the API business, let&rsquo;s first define the terms used in the context of the Kubernetes API server.</p>
<h4 id="kind">Kind</h4>
<p>The type of an entity. Each object has a field <code>Kind</code>, which tells a client such as <code>kubectl</code> that it represent, for example, a pod. There are three categories of kinds.</p>
<ul>
<li>Objects represent <em>a persistent entity in the system</em> &ndash; for example, Pod or Endpoints.  Objects have names, and many of the live in namespaces.</li>
<li>Lists are collections of one or more kinds of entities.  List have a limit set of common metadata. Examples include PodLists or NodeLists. When you do a kubectl get pods, that&rsquo;s exactly what you get.</li>
<li><code>Special-purpose kinds</code> are used for specific actions on objects and for nonpersistent entities such as <em>/binding</em> or /scale. For discovery, Kubernetes use <code>APIGroup</code> and <code>APIResource</code>; for error results, it use <code>Status</code>.</li>
</ul>
<p>In Kubernetes programs, a kind directly corresponds with a Golang type. Thus, as a Golang type, kinds are singular and begin with a capital letter.</p>
<h4 id="api-group">API group</h4>
<p>A collection of Kinds that are logically related. For example, all batch objects like Job or ScheduledJob are in the batch API group.</p>
<h4 id="version">Version</h4>
<p>Each API group can exist in multiple versions, and most of them do. For examples, a group first appears as v1alpha1 and is then promoted to v1beta1 and finally graduates to v1. An object created in one version can be retrieved in each of the supported version. The API server does the lossless conversion to return objects in the requested version. From the cluster user&rsquo;s point of view, versions are just different representations of the same objects.</p>
<blockquote>
<p><strong>TIP</strong></p>
<p>There is no such thing as &ldquo;on object is in v1 in the cluster, and another object is in v1beta1 in the cluster.&rdquo;  Instead, every object can be returned as v1 representation or v1alpha1 representation, as the cluster user desires.</p>
</blockquote>
<h4 id="resource">Resource</h4>
<p>A usually lowercase, plural word(e.g., pods) identifying as a set of HTTP endpoints(paths) exposing the CRUD semantics of a certain object type in the system. Common path are:</p>
<ul>
<li>The root, such as &hellip;/pods, which list all instances of that type.</li>
<li>A path for individual named resources, such as &hellip;./pods/nginx.</li>
</ul>
<p>Typically,  each of this endpoints returns and receives one kind(a PodList in the first case, and a Pod in the second). But in other situations,  a Status kind object is returned.</p>
<p>In addition to the main resource with full CRUD semantics, a resource can have further endpoints to perform specific actions(e.g., &hellip;/pod/nginx/port-forward, ../pod/nginx/exec, or &hellip;/pod/nginx/logs). We call these <code>subresources</code>. These usually implement custom protocols instead of REST &ndash; for example, some kind of streaming connections via WebSocket or imperative APIs.</p>
<blockquote>
<p>TIP</p>
<p>Resources and kinds are often mixed up. Note the clear distinction:</p>
<ul>
<li>Resources correspond to HTTP paths</li>
<li>Kind are the type of objects returned by and received by these endpoints, as well as persisted into etcd.</li>
</ul>
</blockquote>
<h3 id="kubernets-api-versioning">Kubernets API Versioning</h3>
<h3 id="declarative-state-management">Declarative State Management</h3>
<h2 id="how-the-api-server-process-the-request">How the API Server Process the request</h2>
<p>API HTTP handler -&gt; authn &amp; authz -&gt; Mutating adminssion -&gt; Object schema validation -&gt; Validating admission -&gt; Presisting to etcd</p>
<p>K8s version v1.23.0</p>
<p>name</p>
<p>kind</p>
<p>shortNames</p>
<p>categories</p>
<p>resources</p>
<h4 id="apiv1">api/v1</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>k get --raw /api/v1 | jq -c  <span style="color:#e6db74">&#39;.resources[]|{name,kind,shortNames,categories}&#39;</span>
</span></span></code></pre></div><p><p class="md__image">








        <img src="image-20220212224529473.png" alt="image-20220212224529473" />



</p>
</p>
<h4 id="apisbatch">apis/batch</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>k get --raw /apis/batch/v1 | jq -c  <span style="color:#e6db74">&#39;.resources[]|{name,kind,shortNames,categories}&#39;</span>
</span></span></code></pre></div><p><p class="md__image">








        <img src="image-20220212224012052.png" alt="image-20220212224012052" />



</p>
</p>
<h4 id="apisappsv1">apis/apps/v1</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>k get --raw /apis/apps/v1 | jq -c  <span style="color:#e6db74">&#39;.resources[]|{name,kind,shortNames,categories}&#39;</span>
</span></span></code></pre></div><p><p class="md__image">








        <img src="image-20220212230119903.png" alt="image-20220212230119903" />



</p>
</p>
<h3 id="deepcopy-gen">deepcopy-gen</h3>
<p>deepcopy-gen 是一个自动生成DeepCopy函数的代码生成器。给定一个包的目录路径作为输入源，它可以为其生成DeepCopy相关函数，这些函数可以有效的执行每种类型的深复制操作。</p>

        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/airren/airren.github.io/edit/master/content/blog/k8s_source_code_2_api_basic.md" title="Improve this page" target="_blank" rel="noopener">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        







  





  
  

  
  


<div class="row next-prev-navigator">
  
  
</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#controller-and-operator">Controller and Operator</a>
      <ul>
        <li><a href="#the-control-loop">The Control Loop</a>
          <ul>
            <li><a href="#informers">Informers</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#the-api-server">The API Server</a>
      <ul>
        <li><a href="#the-http-interface-of-the-api-server">The HTTP Interface of the API Server</a></li>
        <li><a href="#api-terminology">API Terminology</a>
          <ul>
            <li><a href="#kind">Kind</a></li>
            <li><a href="#api-group">API group</a></li>
            <li><a href="#version">Version</a></li>
            <li><a href="#resource">Resource</a></li>
          </ul>
        </li>
        <li><a href="#kubernets-api-versioning">Kubernets API Versioning</a></li>
        <li><a href="#declarative-state-management">Declarative State Management</a></li>
      </ul>
    </li>
    <li><a href="#how-the-api-server-process-the-request">How the API Server Process the request</a>
      <ul>
        <li>
          <ul>
            <li><a href="#apiv1">api/v1</a></li>
            <li><a href="#apisbatch">apis/batch</a></li>
            <li><a href="#apisappsv1">apis/apps/v1</a></li>
          </ul>
        </li>
        <li><a href="#deepcopy-gen">deepcopy-gen</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    
    











  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-4 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#skills">Skills</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#recent-posts">Recent Posts</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#achievements">My Story</a>
                </li>
              
          </ul>
          
        </div>
        
        
        <div class="col-md-4 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
            <li><span>Email: </span> <span>airrenzero#gmail.com</span></li>
            
            <li><span>Phone: </span> <span>&#43;86 1881733xxxx</span></li>
            
          </ul>
        </div>
        
        
        
          
          <div class="col-md-4 col-sm-12">
            <p>Stay up to date with email notification</p>
              
              <form
                action="https://github.us1.list-manage.com/subscribe/post?u=19de52a4603135aae97163fd8&amp;amp;id=094a24c76e"
                method="post"
                id="mc-embedded-subscribe-form"
                name="mc-embedded-subscribe-form"
                class="validate"
                target="_blank"
                novalidate >
                <div class="form-group">
                  <input
                    type="email"
                    class="form-control"
                    id="mce-EMAIL"
                    name="EMAIL"
                    aria-describedby="emailHelp"
                    placeholder="Enter email"
                  />
                  <small id="emailHelp" class="form-text text-muted"
                    >By entering your email address, you agree to receive the newsletter of this website.</small
                  >
                </div>
                <button type="submit" class="btn btn-info">Submit</button>
              </form>
            
          </div>
        
      </div>
    </div>
    
    
    <hr />
    <div class="container">
      <div class="row text-left">
        <div class="col-md-4">
          <a id="theme" href="https://github.com/hossainemruz/toha" target="_blank" rel="noopener">
            <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png" alt="Toha Theme Logo">
            Toha
          </a>
        </div>
        <div class="col-md-4 text-center">© 2020-2021 Copyright.</div>
        <div class="col-md-4 text-right">
          <a id="hugo" href="https://gohugo.io/" target="_blank" rel="noopener">Powered by
          <img
            src="/images/hugo-logo.svg"
            alt="Hugo Logo"
            height="18"
          />
          </a>
        </div>
      </div>
    </div>
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
